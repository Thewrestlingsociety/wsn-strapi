import {
  COMMON_USER_SCHEMA
} from "./chunk-4MMPDPHN.js";
import {
  getDisplayName
} from "./chunk-3RBYMKQI.js";
import {
  useGuidedTour
} from "./chunk-ZE7NAT3H.js";
import "./chunk-QPJH3FO4.js";
import "./chunk-SZLBMEW5.js";
import "./chunk-2VEIPWEH.js";
import {
  MemoizedInputRenderer
} from "./chunk-5N4RBM6D.js";
import {
  Form
} from "./chunk-CCSOMNNS.js";
import {
  errorsTrads
} from "./chunk-IFOFBKTA.js";
import {
  create4 as create,
  create6 as create2,
  require_upperFirst
} from "./chunk-4H2ZWALN.js";
import "./chunk-Z6T66C2C.js";
import {
  Layouts
} from "./chunk-6UDXJGN3.js";
import {
  useIsDesktop
} from "./chunk-YRRE432D.js";
import {
  useTracking
} from "./chunk-W2Y3XAHI.js";
import "./chunk-U4PP6BRM.js";
import "./chunk-3GJUYW3U.js";
import "./chunk-2BRU7SL4.js";
import "./chunk-TCG3ZXVK.js";
import {
  Page,
  useAPIErrorHandler
} from "./chunk-SCW6OSIS.js";
import {
  useAuth,
  useIsSSOLockedQuery,
  useUpdateMeMutation
} from "./chunk-YSYVPEEC.js";
import {
  useTypedDispatch,
  useTypedSelector
} from "./chunk-NKRVL7KU.js";
import {
  useNotification
} from "./chunk-73XSTVGM.js";
import {
  isBaseQueryError,
  setAppTheme
} from "./chunk-HQG3ICNW.js";
import "./chunk-SHFDKESM.js";
import "./chunk-JVH4XK5B.js";
import "./chunk-KTKIRFL6.js";
import "./chunk-NYUHZLRC.js";
import "./chunk-QOUV5O5E.js";
import {
  Gm,
  I,
  R,
  T,
  Um,
  useIntl,
  zn
} from "./chunk-5DNSEMX4.js";
import "./chunk-QECYQD6B.js";
import "./chunk-AWHRF5BE.js";
import {
  t5
} from "./chunk-URHUI7CZ.js";
import {
  require_jsx_runtime
} from "./chunk-LMPM4PM5.js";
import "./chunk-AYMNGYKI.js";
import {
  require_react
} from "./chunk-D3I3COXH.js";
import {
  __toESM
} from "./chunk-LK32TJAX.js";

// node_modules/@strapi/admin/dist/admin/admin/src/pages/ProfilePage.mjs
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var React = __toESM(require_react(), 1);
var import_upperFirst = __toESM(require_upperFirst(), 1);
var PROFILE_VALIDTION_SCHEMA = create2().shape({
  ...COMMON_USER_SCHEMA,
  currentPassword: create().when([
    "password",
    "confirmPassword"
  ], (password, confirmPassword, passSchema) => {
    return password || confirmPassword ? passSchema.required({
      id: errorsTrads.required.id,
      defaultMessage: "This field is required"
    }).nullable() : passSchema;
  }),
  preferedLanguage: create().nullable()
});
var Panel = ({ children, ...flexProps }) => {
  return (0, import_jsx_runtime.jsx)(R, {
    background: "neutral0",
    hasRadius: true,
    shadow: "filterShadow",
    paddingTop: 6,
    paddingBottom: 6,
    paddingLeft: 7,
    paddingRight: 7,
    children: (0, import_jsx_runtime.jsx)(T, {
      direction: "column",
      alignItems: "stretch",
      gap: 4,
      ...flexProps,
      children
    })
  });
};
var ProfilePage = () => {
  const isDesktop = useIsDesktop();
  const localeNames = useTypedSelector((state) => state.admin_app.language.localeNames);
  const { formatMessage } = useIntl();
  const { trackUsage } = useTracking();
  const { toggleNotification } = useNotification();
  const { notifyStatus } = Gm();
  const currentTheme = useTypedSelector((state) => state.admin_app.theme.currentTheme);
  const dispatch = useTypedDispatch();
  const { _unstableFormatValidationErrors: formatValidationErrors, _unstableFormatAPIError: formatApiError } = useAPIErrorHandler();
  const user = useAuth("ProfilePage", (state) => state.user);
  React.useEffect(() => {
    if (user) {
      notifyStatus(formatMessage({
        id: "Settings.profile.form.notify.data.loaded",
        defaultMessage: "Your profile data has been loaded"
      }));
    } else {
      toggleNotification({
        type: "danger",
        message: formatMessage({
          id: "notification.error",
          defaultMessage: "An error occured"
        })
      });
    }
  }, [
    formatMessage,
    notifyStatus,
    toggleNotification,
    user
  ]);
  const [updateMe, { isLoading: isSubmittingForm }] = useUpdateMeMutation();
  const { isLoading, data: dataSSO, error } = useIsSSOLockedQuery(void 0, {
    skip: !(window.strapi.isEE && window.strapi.features.isEnabled("sso"))
  });
  React.useEffect(() => {
    if (error) {
      toggleNotification({
        type: "danger",
        message: formatMessage({
          id: "Settings.permissions.users.sso.provider.error"
        })
      });
    }
  }, [
    error,
    formatMessage,
    toggleNotification
  ]);
  const handleSubmit = async (body, { setErrors }) => {
    const { confirmPassword: _confirmPassword, currentTheme: currentTheme2, ...bodyRest } = body;
    let dataToSend = bodyRest;
    if (dataToSend.password === "") {
      const { password: _password, currentPassword: _currentPassword, ...passwordRequestBodyRest } = dataToSend;
      dataToSend = passwordRequestBodyRest;
    }
    const res = await updateMe(dataToSend);
    if ("data" in res) {
      dispatch(setAppTheme(currentTheme2));
      trackUsage("didChangeMode", {
        newMode: currentTheme2
      });
      toggleNotification({
        type: "success",
        message: formatMessage({
          id: "notification.success.saved",
          defaultMessage: "Saved"
        })
      });
    }
    if ("error" in res) {
      if (isBaseQueryError(res.error) && res.error.name === "ValidationError") {
        setErrors(formatValidationErrors(res.error));
      } else if (isBaseQueryError(res.error)) {
        toggleNotification({
          type: "danger",
          message: formatApiError(res.error)
        });
      } else {
        toggleNotification({
          type: "danger",
          message: formatMessage({
            id: "notification.error",
            defaultMessage: "An error occured"
          })
        });
      }
    }
  };
  if (isLoading) {
    return (0, import_jsx_runtime.jsx)(Page.Loading, {});
  }
  const hasLockedRole = (dataSSO == null ? void 0 : dataSSO.isSSOLocked) ?? false;
  const { email, firstname, lastname, username, preferedLanguage } = user ?? {};
  const initialData = {
    email: email ?? "",
    firstname: firstname ?? "",
    lastname: lastname ?? "",
    username: username ?? "",
    preferedLanguage,
    currentTheme,
    confirmPassword: "",
    password: ""
  };
  return (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, {
    children: (0, import_jsx_runtime.jsxs)(Page.Main, {
      "aria-busy": isSubmittingForm,
      children: [
        (0, import_jsx_runtime.jsx)(Page.Title, {
          children: formatMessage({
            id: "Settings.profile.form.section.head.title",
            defaultMessage: "User profile"
          })
        }),
        (0, import_jsx_runtime.jsx)(Form, {
          method: "PUT",
          onSubmit: handleSubmit,
          initialValues: initialData,
          validationSchema: PROFILE_VALIDTION_SCHEMA,
          children: ({ isSubmitting, modified }) => (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, {
            children: [
              (0, import_jsx_runtime.jsx)(Layouts.Header, {
                title: getDisplayName(user),
                primaryAction: (0, import_jsx_runtime.jsx)(zn, {
                  startIcon: (0, import_jsx_runtime.jsx)(t5, {}),
                  loading: isSubmitting,
                  type: "submit",
                  disabled: !modified,
                  fullWidth: true,
                  children: formatMessage({
                    id: "global.save",
                    defaultMessage: "Save"
                  })
                })
              }),
              (0, import_jsx_runtime.jsx)(R, {
                paddingBottom: 6,
                children: (0, import_jsx_runtime.jsx)(Layouts.Content, {
                  children: (0, import_jsx_runtime.jsxs)(T, {
                    direction: "column",
                    alignItems: "stretch",
                    gap: 6,
                    children: [
                      (0, import_jsx_runtime.jsx)(UserInfoSection, {}),
                      !hasLockedRole && (0, import_jsx_runtime.jsx)(PasswordSection, {}),
                      (0, import_jsx_runtime.jsx)(PreferencesSection, {
                        localeNames
                      })
                    ]
                  })
                })
              })
            ]
          })
        }),
        isDesktop && true && (0, import_jsx_runtime.jsx)(R, {
          paddingBottom: 6,
          children: (0, import_jsx_runtime.jsx)(Layouts.Content, {
            children: (0, import_jsx_runtime.jsx)(GuidedTourSection, {})
          })
        })
      ]
    })
  });
};
var PasswordSection = () => {
  const { formatMessage } = useIntl();
  return (0, import_jsx_runtime.jsxs)(Panel, {
    children: [
      (0, import_jsx_runtime.jsx)(I, {
        variant: "delta",
        tag: "h2",
        children: formatMessage({
          id: "global.change-password",
          defaultMessage: "Change password"
        })
      }),
      [
        [
          {
            label: formatMessage({
              id: "Auth.form.currentPassword.label",
              defaultMessage: "Current Password"
            }),
            name: "currentPassword",
            size: 6,
            type: "password"
          }
        ],
        [
          {
            autoComplete: "new-password",
            label: formatMessage({
              id: "global.password",
              defaultMessage: "Password"
            }),
            name: "password",
            size: 6,
            type: "password"
          },
          {
            autoComplete: "new-password",
            label: formatMessage({
              id: "Auth.form.confirmPassword.label",
              defaultMessage: "Confirm Password"
            }),
            name: "confirmPassword",
            size: 6,
            type: "password"
          }
        ]
      ].map((row, index) => (0, import_jsx_runtime.jsx)(Um.Root, {
        gap: 5,
        children: row.map(({ size, ...field }) => (0, import_jsx_runtime.jsx)(Um.Item, {
          xs: 12,
          m: 6,
          col: size,
          direction: "column",
          alignItems: "stretch",
          children: (0, import_jsx_runtime.jsx)(MemoizedInputRenderer, {
            ...field
          })
        }, field.name))
      }, index))
    ]
  });
};
var PreferencesSection = ({ localeNames }) => {
  const { formatMessage } = useIntl();
  const themesToDisplay = useTypedSelector((state) => state.admin_app.theme.availableThemes);
  return (0, import_jsx_runtime.jsxs)(Panel, {
    children: [
      (0, import_jsx_runtime.jsxs)(T, {
        direction: "column",
        alignItems: "stretch",
        gap: 1,
        children: [
          (0, import_jsx_runtime.jsx)(I, {
            variant: "delta",
            tag: "h2",
            children: formatMessage({
              id: "Settings.profile.form.section.experience.title",
              defaultMessage: "Experience"
            })
          }),
          (0, import_jsx_runtime.jsx)(I, {
            children: formatMessage({
              id: "Settings.profile.form.section.experience.interfaceLanguageHelp",
              defaultMessage: "Preference changes will apply only to you. More information is available {here}."
            }, {
              here: (0, import_jsx_runtime.jsx)(R, {
                tag: "a",
                color: "primary600",
                target: "_blank",
                rel: "noopener noreferrer",
                href: "https://docs.strapi.io/developer-docs/latest/development/admin-customization.html#locales",
                children: formatMessage({
                  id: "Settings.profile.form.section.experience.here",
                  defaultMessage: "here"
                })
              })
            })
          })
        ]
      }),
      (0, import_jsx_runtime.jsx)(Um.Root, {
        gap: 5,
        children: [
          {
            hint: formatMessage({
              id: "Settings.profile.form.section.experience.interfaceLanguage.hint",
              defaultMessage: "This will only display your own interface in the chosen language."
            }),
            label: formatMessage({
              id: "Settings.profile.form.section.experience.interfaceLanguage",
              defaultMessage: "Interface language"
            }),
            name: "preferedLanguage",
            options: Object.entries(localeNames).map(([value, label]) => ({
              label,
              value
            })),
            placeholder: formatMessage({
              id: "global.select",
              defaultMessage: "Select"
            }),
            size: 6,
            type: "enumeration"
          },
          {
            hint: formatMessage({
              id: "Settings.profile.form.section.experience.mode.hint",
              defaultMessage: "Displays your interface in the chosen mode."
            }),
            label: formatMessage({
              id: "Settings.profile.form.section.experience.mode.label",
              defaultMessage: "Interface mode"
            }),
            name: "currentTheme",
            options: [
              {
                label: formatMessage({
                  id: "Settings.profile.form.section.experience.mode.option-system-label",
                  defaultMessage: "Use system settings"
                }),
                value: "system"
              },
              ...themesToDisplay.map((theme) => ({
                label: formatMessage({
                  id: "Settings.profile.form.section.experience.mode.option-label",
                  defaultMessage: "{name} mode"
                }, {
                  name: formatMessage({
                    id: theme,
                    defaultMessage: (0, import_upperFirst.default)(theme)
                  })
                }),
                value: theme
              }))
            ],
            placeholder: formatMessage({
              id: "components.Select.placeholder",
              defaultMessage: "Select"
            }),
            size: 6,
            type: "enumeration"
          }
        ].map(({ size, ...field }) => (0, import_jsx_runtime.jsx)(Um.Item, {
          xs: 12,
          m: 6,
          col: size,
          direction: "column",
          alignItems: "stretch",
          children: (0, import_jsx_runtime.jsx)(MemoizedInputRenderer, {
            ...field
          })
        }, field.name))
      })
    ]
  });
};
var UserInfoSection = () => {
  const { formatMessage } = useIntl();
  return (0, import_jsx_runtime.jsxs)(Panel, {
    children: [
      (0, import_jsx_runtime.jsx)(I, {
        variant: "delta",
        tag: "h2",
        children: formatMessage({
          id: "global.profile",
          defaultMessage: "Profile"
        })
      }),
      (0, import_jsx_runtime.jsx)(Um.Root, {
        gap: 5,
        children: [
          {
            label: formatMessage({
              id: "Auth.form.firstname.label",
              defaultMessage: "First name"
            }),
            name: "firstname",
            required: true,
            size: 6,
            type: "string"
          },
          {
            label: formatMessage({
              id: "Auth.form.lastname.label",
              defaultMessage: "Last name"
            }),
            name: "lastname",
            size: 6,
            type: "string"
          },
          {
            label: formatMessage({
              id: "Auth.form.email.label",
              defaultMessage: "Email"
            }),
            name: "email",
            required: true,
            size: 6,
            type: "email"
          },
          {
            label: formatMessage({
              id: "Auth.form.username.label",
              defaultMessage: "Username"
            }),
            name: "username",
            size: 6,
            type: "string"
          }
        ].map(({ size, ...field }) => (0, import_jsx_runtime.jsx)(Um.Item, {
          xs: 12,
          m: 6,
          col: size,
          direction: "column",
          alignItems: "stretch",
          children: (0, import_jsx_runtime.jsx)(MemoizedInputRenderer, {
            ...field
          })
        }, field.name))
      })
    ]
  });
};
var GuidedTourSection = () => {
  const { formatMessage } = useIntl();
  const { toggleNotification } = useNotification();
  const dispatch = useGuidedTour("ProfilePage", (s) => s.dispatch);
  const onClickReset = () => {
    dispatch({
      type: "reset_all_tours"
    });
    toggleNotification({
      type: "success",
      message: formatMessage({
        id: "tours.profile.notification.success.reset",
        defaultMessage: "Guided tour reset"
      })
    });
  };
  return (0, import_jsx_runtime.jsxs)(Panel, {
    alignItems: "start",
    children: [
      (0, import_jsx_runtime.jsxs)(T, {
        direction: "column",
        alignItems: "start",
        gap: 1,
        children: [
          (0, import_jsx_runtime.jsx)(I, {
            variant: "delta",
            tag: "h2",
            children: formatMessage({
              id: "tours.profile.title",
              defaultMessage: "Guided tour"
            })
          }),
          (0, import_jsx_runtime.jsx)(I, {
            variant: "pi",
            children: formatMessage({
              id: "tours.profile.description",
              defaultMessage: "You can reset the guided tour at any time."
            })
          })
        ]
      }),
      (0, import_jsx_runtime.jsx)(zn, {
        variant: "tertiary",
        onClick: onClickReset,
        children: formatMessage({
          id: "tours.profile.reset",
          defaultMessage: "Reset guided tour"
        })
      })
    ]
  });
};
export {
  ProfilePage
};
//# sourceMappingURL=ProfilePage-MQYWCX2T.js.map
