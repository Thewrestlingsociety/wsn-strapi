import {
  RelativeTime,
  ReleaseModal,
  ReleasesPage,
  getBadgeProps
} from "./chunk-QNPWNIKO.js";
import {
  utcToZonedTime
} from "./chunk-ALSACCOU.js";
import {
  ReleaseActionMenu,
  ReleaseActionOptions
} from "./chunk-P2NEFJHR.js";
import "./chunk-66BU3UUU.js";
import {
  PERMISSIONS
} from "./chunk-EBVWQ5LF.js";
import {
  getTimezoneOffset,
  releaseApi,
  useDeleteReleaseMutation,
  useGetReleaseActionsQuery,
  useGetReleaseQuery,
  useGetReleaseSettingsQuery,
  usePublishReleaseMutation,
  useUpdateReleaseActionMutation,
  useUpdateReleaseMutation
} from "./chunk-OJRIJOTH.js";
import "./chunk-T4EQJ73T.js";
import "./chunk-R5NSSBTY.js";
import "./chunk-XN4JUFFQ.js";
import "./chunk-7TSPEISL.js";
import "./chunk-4FGMAZ2K.js";
import "./chunk-3GKSM22F.js";
import "./chunk-J4I5BV64.js";
import {
  useDocument
} from "./chunk-E554YL5R.js";
import "./chunk-BG6VH4ZX.js";
import "./chunk-EJGV2DEL.js";
import "./chunk-4DQGMWR3.js";
import "./chunk-N7SUDBVV.js";
import "./chunk-Z6ZBD5ZS.js";
import "./chunk-3UZRBSKL.js";
import "./chunk-75XTHHTN.js";
import "./chunk-NBYLL4QO.js";
import "./chunk-KMBORWDP.js";
import "./chunk-HR4JXMKF.js";
import "./chunk-KWNR5XER.js";
import "./chunk-7RF4BPXI.js";
import "./chunk-QIJGNK42.js";
import "./chunk-KPJDTIXV.js";
import "./chunk-N35NTRDZ.js";
import "./chunk-O2GOGVK5.js";
import {
  Pagination
} from "./chunk-6A3IARPD.js";
import {
  Table
} from "./chunk-6MMPRXTW.js";
import "./chunk-TLJA5XSG.js";
import "./chunk-22AUNARN.js";
import "./chunk-P3KG67LP.js";
import "./chunk-BYONMGEP.js";
import "./chunk-WN6LT3E4.js";
import "./chunk-NQMOZJLG.js";
import "./chunk-OHKBPQVR.js";
import "./chunk-GHMWZORV.js";
import {
  ConfirmDialog
} from "./chunk-CB6IN4G2.js";
import {
  useRBAC
} from "./chunk-VPZQ6GTL.js";
import {
  format
} from "./chunk-VWSKQQU3.js";
import "./chunk-DX6EQQXK.js";
import "./chunk-MBK4V2X7.js";
import "./chunk-D4WYVNVM.js";
import "./chunk-MMOBCIZG.js";
import "./chunk-RTEELHZI.js";
import "./chunk-77BQH5MQ.js";
import "./chunk-BWT2CGTF.js";
import "./chunk-X6MHUDNO.js";
import "./chunk-34XEQUSR.js";
import "./chunk-NOIIXFLG.js";
import {
  BackButton
} from "./chunk-6FGF5FYL.js";
import "./chunk-IFOFBKTA.js";
import "./chunk-KSFRPKJS.js";
import "./chunk-Z6T66C2C.js";
import "./chunk-UIVAYREU.js";
import {
  Layouts
} from "./chunk-OQLA2FRL.js";
import "./chunk-YRRE432D.js";
import {
  useTracking
} from "./chunk-7Z2OL3OT.js";
import "./chunk-MC3SZO52.js";
import "./chunk-3GJUYW3U.js";
import "./chunk-PQINNV4N.js";
import "./chunk-2BRU7SL4.js";
import "./chunk-TCG3ZXVK.js";
import {
  K,
  Page,
  useAPIErrorHandler
} from "./chunk-SOD5YRWW.js";
import {
  useQueryParams,
  useStrapiApp
} from "./chunk-XFZS7AGH.js";
import "./chunk-XOCYTYV7.js";
import {
  useNotification
} from "./chunk-X65BO5UC.js";
import {
  isFetchError,
  require_lib
} from "./chunk-ESSUPVTG.js";
import {
  useDispatch
} from "./chunk-SCCN2M3I.js";
import "./chunk-JVH4XK5B.js";
import "./chunk-KTKIRFL6.js";
import "./chunk-NYUHZLRC.js";
import "./chunk-QOUV5O5E.js";
import {
  A1,
  Am,
  I,
  Jm,
  Ps,
  R1,
  T,
  _m,
  ad,
  c1,
  e1,
  t1,
  useIntl,
  wo,
  yo,
  zn
} from "./chunk-SVMBPSSC.js";
import "./chunk-7K6WC7UG.js";
import {
  Link,
  Navigate,
  Route,
  Routes,
  useNavigate,
  useParams
} from "./chunk-QECYQD6B.js";
import "./chunk-AWHRF5BE.js";
import {
  E3,
  H5,
  I2,
  J2,
  _3,
  a5,
  bn
} from "./chunk-URHUI7CZ.js";
import {
  require_jsx_runtime
} from "./chunk-LMPM4PM5.js";
import {
  ct
} from "./chunk-AYMNGYKI.js";
import {
  require_react
} from "./chunk-D3I3COXH.js";
import {
  __toESM
} from "./chunk-LK32TJAX.js";

// node_modules/@strapi/content-releases/dist/admin/pages/App.mjs
var import_jsx_runtime3 = __toESM(require_jsx_runtime(), 1);

// node_modules/@strapi/content-releases/dist/admin/pages/ReleaseDetailsPage.mjs
var import_jsx_runtime2 = __toESM(require_jsx_runtime(), 1);
var React = __toESM(require_react(), 1);

// node_modules/@strapi/content-releases/dist/admin/components/EntryValidationPopover.mjs
var import_jsx_runtime = __toESM(require_jsx_runtime(), 1);
var import_react = __toESM(require_react(), 1);
var import_qs = __toESM(require_lib(), 1);
var StyledPopoverFlex = ct(T)`
  width: 100%;
  max-width: 256px;

  & > * {
    border-bottom: 1px solid ${({ theme }) => theme.colors.neutral150};
  }

  & > *:last-child {
    border-bottom: none;
  }
`;
var ButtonContent = ct(T)`
  svg {
    fill: currentColor;
  }
`;
var CustomStatusButton = ({ children, icon, color }) => {
  return (0, import_jsx_runtime.jsx)(c1.Trigger, {
    children: (0, import_jsx_runtime.jsx)(zn, {
      variant: "ghost",
      endIcon: (0, import_jsx_runtime.jsx)(J2, {}),
      children: (0, import_jsx_runtime.jsxs)(ButtonContent, {
        color,
        gap: 2,
        children: [
          icon,
          (0, import_jsx_runtime.jsx)(I, {
            textColor: color,
            variant: "omega",
            fontWeight: "bold",
            children
          })
        ]
      })
    })
  });
};
var EntryStatusTrigger = ({ action, status, hasErrors, requiredStage, entryStage }) => {
  const { formatMessage } = useIntl();
  if (action === "publish") {
    if (hasErrors || requiredStage && requiredStage.id !== (entryStage == null ? void 0 : entryStage.id)) {
      return (0, import_jsx_runtime.jsx)(CustomStatusButton, {
        icon: (0, import_jsx_runtime.jsx)(H5, {}),
        color: "danger600",
        children: formatMessage({
          id: "content-releases.pages.ReleaseDetails.entry-validation.not-ready",
          defaultMessage: "Not ready to publish"
        })
      });
    }
    if (status === "draft") {
      return (0, import_jsx_runtime.jsx)(CustomStatusButton, {
        icon: (0, import_jsx_runtime.jsx)(a5, {}),
        color: "success600",
        children: formatMessage({
          id: "content-releases.pages.ReleaseDetails.entry-validation.ready-to-publish",
          defaultMessage: "Ready to publish"
        })
      });
    }
    if (status === "modified") {
      return (0, import_jsx_runtime.jsx)(CustomStatusButton, {
        icon: (0, import_jsx_runtime.jsx)(I2, {}),
        color: "alternative600",
        children: formatMessage({
          id: "content-releases.pages.ReleaseDetails.entry-validation.modified",
          defaultMessage: "Ready to publish changes"
        })
      });
    }
    return (0, import_jsx_runtime.jsx)(CustomStatusButton, {
      icon: (0, import_jsx_runtime.jsx)(a5, {}),
      color: "success600",
      children: formatMessage({
        id: "content-releases.pages.ReleaseDetails.entry-validation.already-published",
        defaultMessage: "Already published"
      })
    });
  }
  if (status === "published") {
    return (0, import_jsx_runtime.jsx)(CustomStatusButton, {
      icon: (0, import_jsx_runtime.jsx)(a5, {}),
      color: "success600",
      children: formatMessage({
        id: "content-releases.pages.ReleaseDetails.entry-validation.ready-to-unpublish",
        defaultMessage: "Ready to unpublish"
      })
    });
  }
  return (0, import_jsx_runtime.jsx)(CustomStatusButton, {
    icon: (0, import_jsx_runtime.jsx)(a5, {}),
    color: "success600",
    children: formatMessage({
      id: "content-releases.pages.ReleaseDetails.entry-validation.already-unpublished",
      defaultMessage: "Already unpublished"
    })
  });
};
var FieldsValidation = ({ hasErrors, errors, kind, contentTypeUid, documentId, locale }) => {
  const { formatMessage } = useIntl();
  return (0, import_jsx_runtime.jsxs)(T, {
    direction: "column",
    gap: 1,
    width: "100%",
    padding: 5,
    children: [
      (0, import_jsx_runtime.jsxs)(T, {
        gap: 2,
        width: "100%",
        children: [
          (0, import_jsx_runtime.jsx)(I, {
            fontWeight: "bold",
            children: formatMessage({
              id: "content-releases.pages.ReleaseDetails.entry-validation.fields",
              defaultMessage: "Fields"
            })
          }),
          hasErrors ? (0, import_jsx_runtime.jsx)(H5, {
            fill: "danger600"
          }) : (0, import_jsx_runtime.jsx)(a5, {
            fill: "success600"
          })
        ]
      }),
      (0, import_jsx_runtime.jsx)(I, {
        width: "100%",
        textColor: "neutral600",
        children: hasErrors ? formatMessage({
          id: "content-releases.pages.ReleaseDetails.entry-validation.fields.error",
          defaultMessage: "{errors} errors on fields."
        }, {
          errors: errors ? Object.keys(errors).length : 0
        }) : formatMessage({
          id: "content-releases.pages.ReleaseDetails.entry-validation.fields.success",
          defaultMessage: "All fields are filled correctly."
        })
      }),
      hasErrors && (0, import_jsx_runtime.jsx)(e1, {
        tag: Link,
        to: {
          pathname: `/content-manager/${kind === "collectionType" ? "collection-types" : "single-types"}/${contentTypeUid}/${documentId}`,
          search: locale ? (0, import_qs.stringify)({
            plugins: {
              i18n: {
                locale
              }
            }
          }) : ""
        },
        variant: "secondary",
        fullWidth: true,
        state: {
          forceValidation: true
        },
        children: formatMessage({
          id: "content-releases.pages.ReleaseDetails.entry-validation.fields.see-errors",
          defaultMessage: "See errors"
        })
      })
    ]
  });
};
var getReviewStageIcon = ({ contentTypeHasReviewWorkflow, requiredStage, entryStage }) => {
  if (!contentTypeHasReviewWorkflow) {
    return (0, import_jsx_runtime.jsx)(a5, {
      fill: "neutral200"
    });
  }
  if (requiredStage && requiredStage.id !== (entryStage == null ? void 0 : entryStage.id)) {
    return (0, import_jsx_runtime.jsx)(H5, {
      fill: "danger600"
    });
  }
  return (0, import_jsx_runtime.jsx)(a5, {
    fill: "success600"
  });
};
var getReviewStageMessage = ({ contentTypeHasReviewWorkflow, requiredStage, entryStage, formatMessage }) => {
  if (!contentTypeHasReviewWorkflow) {
    return formatMessage({
      id: "content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-enabled",
      defaultMessage: "This entry is not associated to any workflow."
    });
  }
  if (requiredStage && requiredStage.id !== (entryStage == null ? void 0 : entryStage.id)) {
    return formatMessage({
      id: "content-releases.pages.ReleaseDetails.entry-validation.review-stage.not-ready",
      defaultMessage: "This entry is not at the required stage for publishing. ({stageName})"
    }, {
      stageName: (requiredStage == null ? void 0 : requiredStage.name) ?? ""
    });
  }
  if (requiredStage && requiredStage.id === (entryStage == null ? void 0 : entryStage.id)) {
    return formatMessage({
      id: "content-releases.pages.ReleaseDetails.entry-validation.review-stage.ready",
      defaultMessage: "This entry is at the required stage for publishing. ({stageName})"
    }, {
      stageName: (requiredStage == null ? void 0 : requiredStage.name) ?? ""
    });
  }
  return formatMessage({
    id: "content-releases.pages.ReleaseDetails.entry-validation.review-stage.stage-not-required",
    defaultMessage: "No required stage for publication"
  });
};
var ReviewStageValidation = ({ contentTypeHasReviewWorkflow, requiredStage, entryStage }) => {
  const { formatMessage } = useIntl();
  const Icon = getReviewStageIcon({
    contentTypeHasReviewWorkflow,
    requiredStage,
    entryStage
  });
  return (0, import_jsx_runtime.jsxs)(T, {
    direction: "column",
    gap: 1,
    width: "100%",
    padding: 5,
    children: [
      (0, import_jsx_runtime.jsxs)(T, {
        gap: 2,
        width: "100%",
        children: [
          (0, import_jsx_runtime.jsx)(I, {
            fontWeight: "bold",
            children: formatMessage({
              id: "content-releases.pages.ReleaseDetails.entry-validation.review-stage",
              defaultMessage: "Review stage"
            })
          }),
          Icon
        ]
      }),
      (0, import_jsx_runtime.jsx)(I, {
        textColor: "neutral600",
        children: getReviewStageMessage({
          contentTypeHasReviewWorkflow,
          requiredStage,
          entryStage,
          formatMessage
        })
      })
    ]
  });
};
var EntryValidationPopover = ({ schema, entry, status, action }) => {
  const { validate, isLoading } = useDocument({
    collectionType: (schema == null ? void 0 : schema.kind) ?? "",
    model: (schema == null ? void 0 : schema.uid) ?? ""
  }, {
    // useDocument makes a request to get more data about the entry, but we only want to have the validation function so we skip the request
    skip: true
  });
  const errors = isLoading ? null : validate(entry);
  const hasErrors = errors ? Object.keys(errors).length > 0 : false;
  const contentTypeHasReviewWorkflow = (schema == null ? void 0 : schema.hasReviewWorkflow) ?? false;
  const requiredStage = schema == null ? void 0 : schema.stageRequiredToPublish;
  const entryStage = entry.strapi_stage;
  if (isLoading) {
    return null;
  }
  return (0, import_jsx_runtime.jsxs)(c1.Root, {
    children: [
      (0, import_jsx_runtime.jsx)(EntryStatusTrigger, {
        action,
        status,
        hasErrors,
        requiredStage,
        entryStage
      }),
      (0, import_jsx_runtime.jsx)(c1.Content, {
        children: (0, import_jsx_runtime.jsxs)(StyledPopoverFlex, {
          direction: "column",
          children: [
            (0, import_jsx_runtime.jsx)(FieldsValidation, {
              hasErrors,
              errors,
              contentTypeUid: schema == null ? void 0 : schema.uid,
              kind: schema == null ? void 0 : schema.kind,
              documentId: entry.documentId,
              locale: entry.locale
            }),
            (0, import_jsx_runtime.jsx)(ReviewStageValidation, {
              contentTypeHasReviewWorkflow,
              requiredStage,
              entryStage
            })
          ]
        })
      })
    ]
  });
};

// node_modules/@strapi/content-releases/dist/admin/store/hooks.mjs
var useTypedDispatch = useDispatch;

// node_modules/@strapi/content-releases/dist/admin/utils/api.mjs
var isBaseQueryError = (error) => {
  return typeof error !== "undefined" && error.name !== void 0;
};

// node_modules/@strapi/content-releases/dist/admin/pages/ReleaseDetailsPage.mjs
var ReleaseInfoWrapper = ct(T)`
  align-self: stretch;
  border-bottom-right-radius: ${({ theme }) => theme.borderRadius};
  border-bottom-left-radius: ${({ theme }) => theme.borderRadius};
  border-top: 1px solid ${({ theme }) => theme.colors.neutral150};
`;
var ReleaseDetailsLayout = ({ toggleEditReleaseModal, toggleWarningSubmit, children }) => {
  const { formatMessage, formatDate, formatTime } = useIntl();
  const { releaseId } = useParams();
  const { data, isLoading: isLoadingDetails, error } = useGetReleaseQuery({
    id: releaseId
  }, {
    skip: !releaseId
  });
  const [publishRelease, { isLoading: isPublishing }] = usePublishReleaseMutation();
  const { toggleNotification } = useNotification();
  const { formatAPIError } = useAPIErrorHandler();
  const { allowedActions } = useRBAC(PERMISSIONS);
  const { canUpdate, canDelete, canPublish } = allowedActions;
  const dispatch = useTypedDispatch();
  const { trackUsage } = useTracking();
  const release = data == null ? void 0 : data.data;
  const handlePublishRelease = (id) => async () => {
    const response = await publishRelease({
      id
    });
    if ("data" in response) {
      toggleNotification({
        type: "success",
        message: formatMessage({
          id: "content-releases.pages.ReleaseDetails.publish-notification-success",
          defaultMessage: "Release was published successfully."
        })
      });
      const { totalEntries: totalEntries2, totalPublishedEntries, totalUnpublishedEntries } = response.data.meta;
      trackUsage("didPublishRelease", {
        totalEntries: totalEntries2,
        totalPublishedEntries,
        totalUnpublishedEntries
      });
    } else if (isFetchError(response.error)) {
      toggleNotification({
        type: "danger",
        message: formatAPIError(response.error)
      });
    } else {
      toggleNotification({
        type: "danger",
        message: formatMessage({
          id: "notification.error",
          defaultMessage: "An error occurred"
        })
      });
    }
  };
  const handleRefresh = () => {
    dispatch(releaseApi.util.invalidateTags([
      {
        type: "ReleaseAction",
        id: "LIST"
      },
      {
        type: "Release",
        id: releaseId
      }
    ]));
  };
  const getCreatedByUser = () => {
    if (!(release == null ? void 0 : release.createdBy)) {
      return null;
    }
    if (release.createdBy.username) {
      return release.createdBy.username;
    }
    if (release.createdBy.firstname) {
      return `${release.createdBy.firstname} ${release.createdBy.lastname || ""}`.trim();
    }
    return release.createdBy.email;
  };
  if (isLoadingDetails) {
    return (0, import_jsx_runtime2.jsx)(Page.Loading, {});
  }
  if (isBaseQueryError(error) && "code" in error || !release) {
    return (0, import_jsx_runtime2.jsx)(Navigate, {
      to: "..",
      state: {
        errors: [
          {
            // @ts-expect-error â€“ TODO: fix this weird error flow
            code: error == null ? void 0 : error.code
          }
        ]
      }
    });
  }
  const totalEntries = release.actions.meta.count || 0;
  const hasCreatedByUser = Boolean(getCreatedByUser());
  const isScheduled = release.scheduledAt && release.timezone;
  const numberOfEntriesText = formatMessage({
    id: "content-releases.pages.Details.header-subtitle",
    defaultMessage: "{number, plural, =0 {No entries} one {# entry} other {# entries}}"
  }, {
    number: totalEntries
  });
  const scheduledText = isScheduled ? formatMessage({
    id: "content-releases.pages.ReleaseDetails.header-subtitle.scheduled",
    defaultMessage: "Scheduled for {date} at {time} ({offset})"
  }, {
    date: formatDate(new Date(release.scheduledAt), {
      weekday: "long",
      day: "numeric",
      month: "long",
      year: "numeric",
      timeZone: release.timezone
    }),
    time: formatTime(new Date(release.scheduledAt), {
      timeZone: release.timezone,
      hourCycle: "h23"
    }),
    offset: getTimezoneOffset(release.timezone, new Date(release.scheduledAt))
  }) : "";
  return (0, import_jsx_runtime2.jsx)(Layouts.Root, {
    children: (0, import_jsx_runtime2.jsxs)(t1, {
      "aria-busy": isLoadingDetails,
      children: [
        (0, import_jsx_runtime2.jsx)(Layouts.Header, {
          title: release.name,
          subtitle: (0, import_jsx_runtime2.jsxs)(T, {
            gap: 2,
            lineHeight: 6,
            children: [
              (0, import_jsx_runtime2.jsx)(I, {
                textColor: "neutral600",
                variant: "epsilon",
                children: numberOfEntriesText + (isScheduled ? ` - ${scheduledText}` : "")
              }),
              (0, import_jsx_runtime2.jsx)(Ps, {
                ...getBadgeProps(release.status),
                children: release.status
              })
            ]
          }),
          navigationAction: (0, import_jsx_runtime2.jsx)(BackButton, {
            fallback: ".."
          }),
          primaryAction: !release.releasedAt && (0, import_jsx_runtime2.jsxs)(T, {
            gap: 2,
            children: [
              (0, import_jsx_runtime2.jsxs)(SimpleMenuButton, {
                label: (0, import_jsx_runtime2.jsx)(E3, {}),
                variant: "tertiary",
                endIcon: null,
                paddingLeft: "7px",
                paddingRight: "7px",
                "aria-label": formatMessage({
                  id: "content-releases.header.actions.open-release-actions",
                  defaultMessage: "Release edit and delete menu"
                }),
                popoverPlacement: "bottom-end",
                children: [
                  (0, import_jsx_runtime2.jsx)(Am.Item, {
                    disabled: !canUpdate,
                    onSelect: toggleEditReleaseModal,
                    startIcon: (0, import_jsx_runtime2.jsx)(_3, {}),
                    children: formatMessage({
                      id: "content-releases.header.actions.edit",
                      defaultMessage: "Edit"
                    })
                  }),
                  (0, import_jsx_runtime2.jsx)(Am.Item, {
                    disabled: !canDelete,
                    onSelect: toggleWarningSubmit,
                    variant: "danger",
                    startIcon: (0, import_jsx_runtime2.jsx)(bn, {}),
                    children: formatMessage({
                      id: "content-releases.header.actions.delete",
                      defaultMessage: "Delete"
                    })
                  }),
                  (0, import_jsx_runtime2.jsxs)(ReleaseInfoWrapper, {
                    direction: "column",
                    justifyContent: "center",
                    alignItems: "flex-start",
                    gap: 1,
                    padding: 4,
                    children: [
                      (0, import_jsx_runtime2.jsx)(I, {
                        variant: "pi",
                        fontWeight: "bold",
                        children: formatMessage({
                          id: "content-releases.header.actions.created",
                          defaultMessage: "Created"
                        })
                      }),
                      (0, import_jsx_runtime2.jsxs)(I, {
                        variant: "pi",
                        color: "neutral300",
                        children: [
                          (0, import_jsx_runtime2.jsx)(RelativeTime, {
                            timestamp: new Date(release.createdAt)
                          }),
                          formatMessage({
                            id: "content-releases.header.actions.created.description",
                            defaultMessage: "{hasCreatedByUser, select, true { by {createdBy}} other { by deleted user}}"
                          }, {
                            createdBy: getCreatedByUser(),
                            hasCreatedByUser
                          })
                        ]
                      })
                    ]
                  })
                ]
              }),
              (0, import_jsx_runtime2.jsx)(zn, {
                size: "S",
                variant: "tertiary",
                onClick: handleRefresh,
                children: formatMessage({
                  id: "content-releases.header.actions.refresh",
                  defaultMessage: "Refresh"
                })
              }),
              canPublish ? (0, import_jsx_runtime2.jsx)(zn, {
                size: "S",
                variant: "default",
                onClick: handlePublishRelease(release.id.toString()),
                loading: isPublishing,
                disabled: release.actions.meta.count === 0,
                children: formatMessage({
                  id: "content-releases.header.actions.publish",
                  defaultMessage: "Publish"
                })
              }) : null
            ]
          })
        }),
        children
      ]
    })
  });
};
var SimpleMenuButton = ct(ad)`
  & > span {
    display: flex;
  }
`;
var GROUP_BY_OPTIONS = [
  "contentType",
  "locale",
  "action"
];
var GROUP_BY_OPTIONS_NO_LOCALE = [
  "contentType",
  "action"
];
var getGroupByOptionLabel = (value) => {
  if (value === "locale") {
    return {
      id: "content-releases.pages.ReleaseDetails.groupBy.option.locales",
      defaultMessage: "Locales"
    };
  }
  if (value === "action") {
    return {
      id: "content-releases.pages.ReleaseDetails.groupBy.option.actions",
      defaultMessage: "Actions"
    };
  }
  return {
    id: "content-releases.pages.ReleaseDetails.groupBy.option.content-type",
    defaultMessage: "Content-Types"
  };
};
var ReleaseDetailsBody = ({ releaseId }) => {
  var _a, _b;
  const { formatMessage } = useIntl();
  const [{ query }, setQuery] = useQueryParams();
  const { toggleNotification } = useNotification();
  const { formatAPIError } = useAPIErrorHandler();
  const { data: releaseData, isLoading: isReleaseLoading, error: releaseError } = useGetReleaseQuery({
    id: releaseId
  });
  const { allowedActions: { canUpdate } } = useRBAC(PERMISSIONS);
  const runHookWaterfall = useStrapiApp("ReleaseDetailsPage", (state) => state.runHookWaterfall);
  const { displayedHeaders, hasI18nEnabled } = runHookWaterfall("ContentReleases/pages/ReleaseDetails/add-locale-in-releases", {
    displayedHeaders: [
      {
        label: {
          id: "content-releases.page.ReleaseDetails.table.header.label.name",
          defaultMessage: "name"
        },
        name: "name"
      }
    ],
    hasI18nEnabled: false
  });
  const release = releaseData == null ? void 0 : releaseData.data;
  const selectedGroupBy = (query == null ? void 0 : query.groupBy) || "contentType";
  const { isLoading, isFetching, isError, data, error: releaseActionsError } = useGetReleaseActionsQuery({
    ...query,
    releaseId
  });
  const [updateReleaseAction] = useUpdateReleaseActionMutation();
  const handleChangeType = async (e, actionId, actionPath) => {
    const response = await updateReleaseAction({
      params: {
        releaseId,
        actionId
      },
      body: {
        type: e.target.value
      },
      query,
      actionPath
    });
    if ("error" in response) {
      if (isFetchError(response.error)) {
        toggleNotification({
          type: "danger",
          message: formatAPIError(response.error)
        });
      } else {
        toggleNotification({
          type: "danger",
          message: formatMessage({
            id: "notification.error",
            defaultMessage: "An error occurred"
          })
        });
      }
    }
  };
  if (isLoading || isReleaseLoading) {
    return (0, import_jsx_runtime2.jsx)(Page.Loading, {});
  }
  const releaseActions = data == null ? void 0 : data.data;
  const releaseMeta = data == null ? void 0 : data.meta;
  const contentTypes = (releaseMeta == null ? void 0 : releaseMeta.contentTypes) || {};
  (releaseMeta == null ? void 0 : releaseMeta.components) || {};
  if (isBaseQueryError(releaseError) || !release) {
    const errorsArray = [];
    if (releaseError && "code" in releaseError) {
      errorsArray.push({
        code: releaseError.code
      });
    }
    if (releaseActionsError && "code" in releaseActionsError) {
      errorsArray.push({
        code: releaseActionsError.code
      });
    }
    return (0, import_jsx_runtime2.jsx)(Navigate, {
      to: "..",
      state: {
        errors: errorsArray
      }
    });
  }
  if (isError || !releaseActions) {
    return (0, import_jsx_runtime2.jsx)(Page.Error, {});
  }
  if (Object.keys(releaseActions).length === 0) {
    return (0, import_jsx_runtime2.jsx)(Layouts.Content, {
      children: (0, import_jsx_runtime2.jsx)(Jm, {
        action: (0, import_jsx_runtime2.jsx)(e1, {
          tag: Link,
          to: {
            pathname: "/content-manager"
          },
          style: {
            textDecoration: "none"
          },
          variant: "secondary",
          children: formatMessage({
            id: "content-releases.page.Details.button.openContentManager",
            defaultMessage: "Open the Content Manager"
          })
        }),
        icon: (0, import_jsx_runtime2.jsx)(K, {
          width: "16rem"
        }),
        content: formatMessage({
          id: "content-releases.pages.Details.tab.emptyEntries",
          defaultMessage: "This release is empty. Open the Content Manager, select an entry and add it to the release."
        })
      })
    });
  }
  const groupByLabel = formatMessage({
    id: "content-releases.pages.ReleaseDetails.groupBy.aria-label",
    defaultMessage: "Group by"
  });
  const headers = [
    ...displayedHeaders,
    {
      label: {
        id: "content-releases.page.ReleaseDetails.table.header.label.content-type",
        defaultMessage: "content-type"
      },
      name: "content-type"
    },
    {
      label: {
        id: "content-releases.page.ReleaseDetails.table.header.label.action",
        defaultMessage: "action"
      },
      name: "action"
    },
    ...!release.releasedAt ? [
      {
        label: {
          id: "content-releases.page.ReleaseDetails.table.header.label.status",
          defaultMessage: "status"
        },
        name: "status"
      }
    ] : []
  ];
  const options = hasI18nEnabled ? GROUP_BY_OPTIONS : GROUP_BY_OPTIONS_NO_LOCALE;
  return (0, import_jsx_runtime2.jsx)(Layouts.Content, {
    children: (0, import_jsx_runtime2.jsxs)(T, {
      gap: 4,
      direction: "column",
      alignItems: "stretch",
      children: [
        (0, import_jsx_runtime2.jsx)(T, {
          children: (0, import_jsx_runtime2.jsx)(yo, {
            placeholder: groupByLabel,
            "aria-label": groupByLabel,
            customizeContent: (value) => formatMessage({
              id: `content-releases.pages.ReleaseDetails.groupBy.label`,
              defaultMessage: `Group by {groupBy}`
            }, {
              groupBy: value
            }),
            value: formatMessage(getGroupByOptionLabel(selectedGroupBy)),
            onChange: (value) => setQuery({
              groupBy: value
            }),
            children: options.map((option) => (0, import_jsx_runtime2.jsx)(wo, {
              value: option,
              children: formatMessage(getGroupByOptionLabel(option))
            }, option))
          })
        }),
        Object.keys(releaseActions).map((key) => (0, import_jsx_runtime2.jsxs)(T, {
          gap: 4,
          direction: "column",
          alignItems: "stretch",
          children: [
            (0, import_jsx_runtime2.jsx)(T, {
              role: "separator",
              "aria-label": key,
              children: (0, import_jsx_runtime2.jsx)(Ps, {
                children: key
              })
            }),
            (0, import_jsx_runtime2.jsx)(Table.Root, {
              rows: releaseActions[key].map((item) => ({
                ...item,
                id: Number(item.entry.id)
              })),
              headers,
              isLoading: isLoading || isFetching,
              children: (0, import_jsx_runtime2.jsxs)(Table.Content, {
                children: [
                  (0, import_jsx_runtime2.jsx)(Table.Head, {
                    children: headers.map(({ label, name }) => (0, import_jsx_runtime2.jsx)(Table.HeaderCell, {
                      label: formatMessage(label),
                      name
                    }, name))
                  }),
                  (0, import_jsx_runtime2.jsx)(Table.Loading, {}),
                  (0, import_jsx_runtime2.jsx)(Table.Body, {
                    children: releaseActions[key].map(({ id, contentType, locale, type, entry, status }, actionIndex) => (0, import_jsx_runtime2.jsxs)(A1, {
                      children: [
                        (0, import_jsx_runtime2.jsx)(R1, {
                          width: "25%",
                          maxWidth: "200px",
                          children: (0, import_jsx_runtime2.jsx)(I, {
                            ellipsis: true,
                            children: `${contentType.mainFieldValue || entry.id}`
                          })
                        }),
                        hasI18nEnabled && (0, import_jsx_runtime2.jsx)(R1, {
                          width: "10%",
                          children: (0, import_jsx_runtime2.jsx)(I, {
                            children: `${(locale == null ? void 0 : locale.name) ? locale.name : "-"}`
                          })
                        }),
                        (0, import_jsx_runtime2.jsx)(R1, {
                          width: "10%",
                          children: (0, import_jsx_runtime2.jsx)(I, {
                            children: contentType.displayName || ""
                          })
                        }),
                        (0, import_jsx_runtime2.jsx)(R1, {
                          width: "20%",
                          children: release.releasedAt ? (0, import_jsx_runtime2.jsx)(I, {
                            children: formatMessage({
                              id: "content-releases.page.ReleaseDetails.table.action-published",
                              defaultMessage: "This entry was <b>{isPublish, select, true {published} other {unpublished}}</b>."
                            }, {
                              isPublish: type === "publish",
                              b: (children) => (0, import_jsx_runtime2.jsx)(I, {
                                fontWeight: "bold",
                                children
                              })
                            })
                          }) : (0, import_jsx_runtime2.jsx)(ReleaseActionOptions, {
                            selected: type,
                            handleChange: (e) => handleChangeType(e, id, [
                              key,
                              actionIndex
                            ]),
                            name: `release-action-${id}-type`,
                            disabled: !canUpdate
                          })
                        }),
                        !release.releasedAt && (0, import_jsx_runtime2.jsxs)(import_jsx_runtime2.Fragment, {
                          children: [
                            (0, import_jsx_runtime2.jsx)(R1, {
                              width: "20%",
                              minWidth: "200px",
                              children: (0, import_jsx_runtime2.jsx)(EntryValidationPopover, {
                                action: type,
                                schema: contentTypes == null ? void 0 : contentTypes[contentType.uid],
                                entry,
                                status
                              })
                            }),
                            (0, import_jsx_runtime2.jsx)(R1, {
                              children: (0, import_jsx_runtime2.jsx)(T, {
                                justifyContent: "flex-end",
                                children: (0, import_jsx_runtime2.jsxs)(ReleaseActionMenu.Root, {
                                  children: [
                                    (0, import_jsx_runtime2.jsx)(ReleaseActionMenu.ReleaseActionEntryLinkItem, {
                                      contentTypeUid: contentType.uid,
                                      documentId: entry.documentId,
                                      locale: locale == null ? void 0 : locale.code
                                    }),
                                    (0, import_jsx_runtime2.jsx)(ReleaseActionMenu.DeleteReleaseActionItem, {
                                      releaseId: release.id,
                                      actionId: id
                                    })
                                  ]
                                })
                              })
                            })
                          ]
                        })
                      ]
                    }, id))
                  })
                ]
              })
            })
          ]
        }, `releases-group-${key}`)),
        ((_a = releaseMeta == null ? void 0 : releaseMeta.pagination) == null ? void 0 : _a.pageCount) && releaseMeta.pagination.pageCount > 1 && (0, import_jsx_runtime2.jsxs)(Pagination.Root, {
          ...releaseMeta == null ? void 0 : releaseMeta.pagination,
          defaultPageSize: (_b = releaseMeta == null ? void 0 : releaseMeta.pagination) == null ? void 0 : _b.pageSize,
          children: [
            (0, import_jsx_runtime2.jsx)(Pagination.PageSize, {}),
            (0, import_jsx_runtime2.jsx)(Pagination.Links, {})
          ]
        })
      ]
    })
  });
};
var ReleaseDetailsPage = () => {
  const { formatMessage } = useIntl();
  const { releaseId } = useParams();
  const { toggleNotification } = useNotification();
  const { formatAPIError } = useAPIErrorHandler();
  const navigate = useNavigate();
  const [releaseModalShown, setReleaseModalShown] = React.useState(false);
  const [showWarningSubmit, setWarningSubmit] = React.useState(false);
  const { isLoading: isLoadingDetails, data, isSuccess: isSuccessDetails } = useGetReleaseQuery({
    id: releaseId
  }, {
    skip: !releaseId
  });
  const { data: dataTimezone, isLoading: isLoadingTimezone } = useGetReleaseSettingsQuery();
  const [updateRelease, { isLoading: isSubmittingForm }] = useUpdateReleaseMutation();
  const [deleteRelease] = useDeleteReleaseMutation();
  const toggleEditReleaseModal = () => {
    setReleaseModalShown((prev) => !prev);
  };
  const getTimezoneValue = () => {
    if (releaseData == null ? void 0 : releaseData.timezone) {
      return releaseData.timezone;
    } else {
      if (dataTimezone == null ? void 0 : dataTimezone.data.defaultTimezone) {
        return dataTimezone.data.defaultTimezone;
      }
      return null;
    }
  };
  const toggleWarningSubmit = () => setWarningSubmit((prevState) => !prevState);
  if (isLoadingDetails || isLoadingTimezone) {
    return (0, import_jsx_runtime2.jsx)(ReleaseDetailsLayout, {
      toggleEditReleaseModal,
      toggleWarningSubmit,
      children: (0, import_jsx_runtime2.jsx)(Page.Loading, {})
    });
  }
  if (!releaseId) {
    return (0, import_jsx_runtime2.jsx)(Navigate, {
      to: ".."
    });
  }
  const releaseData = isSuccessDetails && (data == null ? void 0 : data.data) || null;
  const title = (releaseData == null ? void 0 : releaseData.name) || "";
  const timezone = getTimezoneValue();
  const scheduledAt = (releaseData == null ? void 0 : releaseData.scheduledAt) && timezone ? utcToZonedTime(releaseData.scheduledAt, timezone) : null;
  const date = scheduledAt ? format(scheduledAt, "yyyy-MM-dd") : void 0;
  const time = scheduledAt ? format(scheduledAt, "HH:mm") : "";
  const handleEditRelease = async (values) => {
    const response = await updateRelease({
      id: releaseId,
      name: values.name,
      scheduledAt: values.scheduledAt,
      timezone: values.timezone
    });
    if ("data" in response) {
      toggleNotification({
        type: "success",
        message: formatMessage({
          id: "content-releases.modal.release-updated-notification-success",
          defaultMessage: "Release updated."
        })
      });
      toggleEditReleaseModal();
    } else if (isFetchError(response.error)) {
      toggleNotification({
        type: "danger",
        message: formatAPIError(response.error)
      });
    } else {
      toggleNotification({
        type: "danger",
        message: formatMessage({
          id: "notification.error",
          defaultMessage: "An error occurred"
        })
      });
    }
  };
  const handleDeleteRelease = async () => {
    const response = await deleteRelease({
      id: releaseId
    });
    if ("data" in response) {
      navigate("..");
    } else if (isFetchError(response.error)) {
      toggleNotification({
        type: "danger",
        message: formatAPIError(response.error)
      });
    } else {
      toggleNotification({
        type: "danger",
        message: formatMessage({
          id: "notification.error",
          defaultMessage: "An error occurred"
        })
      });
    }
  };
  return (0, import_jsx_runtime2.jsxs)(ReleaseDetailsLayout, {
    toggleEditReleaseModal,
    toggleWarningSubmit,
    children: [
      (0, import_jsx_runtime2.jsx)(ReleaseDetailsBody, {
        releaseId
      }),
      (0, import_jsx_runtime2.jsx)(ReleaseModal, {
        open: releaseModalShown,
        handleClose: toggleEditReleaseModal,
        handleSubmit: handleEditRelease,
        isLoading: isLoadingDetails || isSubmittingForm,
        initialValues: {
          name: title || "",
          scheduledAt,
          date,
          time,
          isScheduled: Boolean(scheduledAt),
          timezone
        }
      }),
      (0, import_jsx_runtime2.jsx)(_m.Root, {
        open: showWarningSubmit,
        onOpenChange: toggleWarningSubmit,
        children: (0, import_jsx_runtime2.jsx)(ConfirmDialog, {
          onConfirm: handleDeleteRelease,
          children: formatMessage({
            id: "content-releases.dialog.confirmation-message",
            defaultMessage: "Are you sure you want to delete this release?"
          })
        })
      })
    ]
  });
};

// node_modules/@strapi/content-releases/dist/admin/pages/App.mjs
var App = () => {
  return (0, import_jsx_runtime3.jsx)(Page.Protect, {
    permissions: PERMISSIONS.main,
    children: (0, import_jsx_runtime3.jsxs)(Routes, {
      children: [
        (0, import_jsx_runtime3.jsx)(Route, {
          index: true,
          element: (0, import_jsx_runtime3.jsx)(ReleasesPage, {})
        }),
        (0, import_jsx_runtime3.jsx)(Route, {
          path: ":releaseId",
          element: (0, import_jsx_runtime3.jsx)(ReleaseDetailsPage, {})
        })
      ]
    })
  });
};
export {
  App
};
//# sourceMappingURL=App-QZCMMTI2.js.map
