{"version":3,"file":"FormHead.mjs","sources":["../../../../../../../../admin/src/pages/Settings/components/Tokens/FormHead.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { Box, Button, Dialog, Flex, Tooltip } from '@strapi/design-system';\nimport { Check, ArrowClockwise, Eye, EyeStriked } from '@strapi/icons';\nimport { MessageDescriptor, useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\n\nimport { ConfirmDialog } from '../../../../components/ConfirmDialog';\nimport { tours } from '../../../../components/GuidedTour/Tours';\nimport { Layouts } from '../../../../components/Layouts/Layout';\nimport { BackButton } from '../../../../features/BackButton';\nimport { useNotification } from '../../../../features/Notifications';\nimport { useAPIErrorHandler } from '../../../../hooks/useAPIErrorHandler';\nimport { useRegenerateTokenMutation } from '../../../../services/transferTokens';\n\nimport type { Data } from '@strapi/types';\n\ninterface RegenerateProps {\n  onRegenerate?: (newKey: string) => void;\n  url: string;\n}\n\nconst ActionButton = styled(Button)`\n  white-space: nowrap;\n`;\n\nconst Regenerate = ({ onRegenerate, url }: RegenerateProps) => {\n  const { formatMessage } = useIntl();\n  const [showConfirmDialog, setShowConfirmDialog] = React.useState(false);\n\n  const [isLoadingConfirmation, setIsLoadingConfirmation] = React.useState(false);\n  const { toggleNotification } = useNotification();\n  const { _unstableFormatAPIError: formatAPIError } = useAPIErrorHandler();\n\n  const [regenerateToken] = useRegenerateTokenMutation();\n\n  const regenerateData = async () => {\n    try {\n      const res = await regenerateToken(url);\n\n      if ('error' in res) {\n        toggleNotification({\n          type: 'danger',\n          message: formatAPIError(res.error),\n        });\n\n        return;\n      }\n\n      if (onRegenerate) {\n        onRegenerate(res.data.accessKey);\n      }\n    } catch (error) {\n      toggleNotification({\n        type: 'danger',\n        message: formatMessage({\n          id: 'notification.error',\n          defaultMessage: 'Something went wrong',\n        }),\n      });\n    } finally {\n      setIsLoadingConfirmation(false);\n    }\n  };\n\n  const handleConfirmRegeneration = async () => {\n    regenerateData();\n    setShowConfirmDialog(false);\n  };\n\n  return (\n    <Dialog.Root open={showConfirmDialog} onOpenChange={setShowConfirmDialog}>\n      <Dialog.Trigger>\n        <ActionButton\n          startIcon={<ArrowClockwise />}\n          type=\"button\"\n          size=\"S\"\n          variant=\"tertiary\"\n          onClick={() => setShowConfirmDialog(true)}\n          name=\"regenerate\"\n          fullWidth\n        >\n          {formatMessage({\n            id: 'Settings.tokens.regenerate',\n            defaultMessage: 'Regenerate',\n          })}\n        </ActionButton>\n      </Dialog.Trigger>\n\n      <ConfirmDialog\n        title={formatMessage({\n          id: 'Settings.tokens.RegenerateDialog.title',\n          defaultMessage: 'Regenerate token',\n        })}\n        endAction={\n          <Button\n            startIcon={<ArrowClockwise />}\n            loading={isLoadingConfirmation}\n            onClick={handleConfirmRegeneration}\n          >\n            {formatMessage({\n              id: 'Settings.tokens.Button.regenerate',\n              defaultMessage: 'Regenerate',\n            })}\n          </Button>\n        }\n      >\n        {formatMessage({\n          id: 'Settings.tokens.popUpWarning.message',\n          defaultMessage: 'Are you sure you want to regenerate this token?',\n        })}\n      </ConfirmDialog>\n    </Dialog.Root>\n  );\n};\n\ninterface Token {\n  id: Data.ID;\n  name: string;\n}\n\ninterface FormHeadProps<TToken extends Token | null> {\n  title: MessageDescriptor;\n  token: TToken;\n  canEditInputs: boolean;\n  canRegenerate: boolean;\n  canShowToken?: boolean;\n  setToken: (token: TToken) => void;\n  toggleToken?: () => void;\n  showToken?: boolean;\n  isSubmitting: boolean;\n  regenerateUrl: string;\n}\n\nexport const FormHead = <TToken extends Token | null>({\n  title,\n  token,\n  setToken,\n  toggleToken,\n  showToken,\n  canShowToken,\n  canEditInputs,\n  canRegenerate,\n  isSubmitting,\n  regenerateUrl,\n}: FormHeadProps<TToken>) => {\n  const { formatMessage } = useIntl();\n  const handleRegenerate = (newKey: string) => {\n    setToken({\n      ...token,\n      accessKey: newKey,\n    });\n    toggleToken?.();\n  };\n\n  return (\n    <Layouts.Header\n      title={token?.name || formatMessage(title)}\n      primaryAction={\n        canEditInputs ? (\n          <Flex width=\"100%\" gap={2} wrap={{ initial: 'wrap', medium: 'nowrap' }}>\n            {canRegenerate && token?.id && (\n              <Regenerate\n                onRegenerate={handleRegenerate}\n                url={`${regenerateUrl}${token?.id ?? ''}`}\n              />\n            )}\n            <Flex width=\"100%\" gap={2}>\n              {token?.id && toggleToken && (\n                <tours.apiTokens.ViewAPIToken>\n                  <Tooltip\n                    label={\n                      !canShowToken &&\n                      formatMessage({\n                        id: 'Settings.tokens.encryptionKeyMissing',\n                        defaultMessage:\n                          'In order to view the token, you need a valid encryption key in the admin configuration',\n                      })\n                    }\n                  >\n                    <ActionButton\n                      type=\"button\"\n                      startIcon={showToken ? <EyeStriked /> : <Eye />}\n                      variant=\"secondary\"\n                      onClick={() => toggleToken?.()}\n                      disabled={!canShowToken}\n                      fullWidth\n                    >\n                      {formatMessage({\n                        id: 'Settings.tokens.viewToken',\n                        defaultMessage: 'View token',\n                      })}\n                    </ActionButton>\n                  </Tooltip>\n                </tours.apiTokens.ViewAPIToken>\n              )}\n              <ActionButton\n                disabled={isSubmitting}\n                loading={isSubmitting}\n                startIcon={<Check />}\n                type=\"submit\"\n                size=\"S\"\n                fullWidth\n              >\n                {formatMessage({\n                  id: 'global.save',\n                  defaultMessage: 'Save',\n                })}\n              </ActionButton>\n            </Flex>\n          </Flex>\n        ) : (\n          canRegenerate &&\n          token?.id && (\n            <Regenerate\n              onRegenerate={handleRegenerate}\n              url={`${regenerateUrl}${token?.id ?? ''}`}\n            />\n          )\n        )\n      }\n      navigationAction={\n        // The back link for mobile works differently; it is placed higher up in the DOM.\n        <Box display={{ initial: 'none', medium: 'block' }}>\n          <BackButton />\n        </Box>\n      }\n      ellipsis\n    />\n  );\n};\n"],"names":["ActionButton","styled","Button","Regenerate","onRegenerate","url","formatMessage","useIntl","showConfirmDialog","setShowConfirmDialog","React","useState","isLoadingConfirmation","setIsLoadingConfirmation","toggleNotification","useNotification","_unstableFormatAPIError","formatAPIError","useAPIErrorHandler","regenerateToken","useRegenerateTokenMutation","regenerateData","res","type","message","error","data","accessKey","id","defaultMessage","handleConfirmRegeneration","_jsxs","Dialog","Root","open","onOpenChange","_jsx","Trigger","startIcon","ArrowClockwise","size","variant","onClick","name","fullWidth","ConfirmDialog","title","endAction","loading","FormHead","token","setToken","toggleToken","showToken","canShowToken","canEditInputs","canRegenerate","isSubmitting","regenerateUrl","handleRegenerate","newKey","Layouts","Header","primaryAction","Flex","width","gap","wrap","initial","medium","tours","apiTokens","ViewAPIToken","Tooltip","label","EyeStriked","Eye","disabled","Check","navigationAction","Box","display","BackButton","ellipsis"],"mappings":"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"}