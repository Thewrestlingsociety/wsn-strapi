{"version":3,"file":"migrations.mjs","sources":["../../../../../../../admin/src/components/GuidedTour/utils/migrations.ts"],"sourcesContent":["import { produce } from 'immer';\n\nimport { tours } from '../Tours';\n\nimport type { State, ValidTourName } from '../Context';\n\n/**\n * Build default tour state (used when stored state is missing tours)\n */\nconst getDefaultTours = () =>\n  (Object.keys(tours) as ValidTourName[]).reduce(\n    (acc, tourName) => {\n      acc[tourName] = { currentStep: 0, isCompleted: false, tourType: undefined };\n      return acc;\n    },\n    {} as State['tours']\n  );\n\n/**\n * Migrates tours added or removed from the tours object.\n * Handles missing or corrupted stored state (e.g. old localStorage without `tours`).\n */\nconst migrateTours = (storedTourState: State) => {\n  if (!storedTourState?.tours || typeof storedTourState.tours !== 'object') {\n    return {\n      ...storedTourState,\n      tours: getDefaultTours(),\n      enabled: storedTourState?.enabled ?? true,\n      completedActions: Array.isArray(storedTourState?.completedActions)\n        ? storedTourState.completedActions\n        : [],\n      hidden: storedTourState?.hidden ?? false,\n    } as State;\n  }\n\n  const storedTourNames = Object.keys(storedTourState.tours) as ValidTourName[];\n  const currentTourNames = Object.keys(tours) as ValidTourName[];\n\n  return produce(storedTourState, (draft) => {\n    // Add new tours that don't exist in stored state\n    currentTourNames.forEach((tourName) => {\n      if (!storedTourNames.includes(tourName)) {\n        draft.tours[tourName] = {\n          currentStep: 0,\n          isCompleted: false,\n          tourType: undefined,\n        };\n      }\n    });\n\n    // Remove tours that no longer exist in current tours\n    storedTourNames.forEach((tourName) => {\n      if (!currentTourNames.includes(tourName)) {\n        delete draft.tours[tourName];\n      }\n    });\n  });\n};\n\nexport { migrateTours };\n"],"names":["getDefaultTours","Object","keys","tours","reduce","acc","tourName","currentStep","isCompleted","tourType","undefined","migrateTours","storedTourState","enabled","completedActions","Array","isArray","hidden","storedTourNames","currentTourNames","produce","draft","forEach","includes"],"mappings":";;;AAMA;;IAGA,MAAMA,eAAkB,GAAA,IACtB,MAACC,CAAOC,IAAI,CAACC,KAA2BC,CAAAA,CAAAA,MAAM,CAC5C,CAACC,GAAKC,EAAAA,QAAAA,GAAAA;QACJD,GAAG,CAACC,SAAS,GAAG;YAAEC,WAAa,EAAA,CAAA;YAAGC,WAAa,EAAA,KAAA;YAAOC,QAAUC,EAAAA;AAAU,SAAA;QAC1E,OAAOL,GAAAA;AACT,KAAA,EACA,EAAC,CAAA;AAGL;;;IAIA,MAAMM,eAAe,CAACC,eAAAA,GAAAA;AACpB,IAAA,IAAI,CAACA,eAAiBT,EAAAA,KAAAA,IAAS,OAAOS,eAAgBT,CAAAA,KAAK,KAAK,QAAU,EAAA;QACxE,OAAO;AACL,YAAA,GAAGS,eAAe;YAClBT,KAAOH,EAAAA,eAAAA,EAAAA;AACPa,YAAAA,OAAAA,EAASD,iBAAiBC,OAAW,IAAA,IAAA;YACrCC,gBAAkBC,EAAAA,KAAAA,CAAMC,OAAO,CAACJ,eAAAA,EAAiBE,oBAC7CF,eAAgBE,CAAAA,gBAAgB,GAChC,EAAE;AACNG,YAAAA,MAAAA,EAAQL,iBAAiBK,MAAU,IAAA;AACrC,SAAA;AACF;AAEA,IAAA,MAAMC,eAAkBjB,GAAAA,MAAAA,CAAOC,IAAI,CAACU,gBAAgBT,KAAK,CAAA;IACzD,MAAMgB,gBAAAA,GAAmBlB,MAAOC,CAAAA,IAAI,CAACC,KAAAA,CAAAA;IAErC,OAAOiB,OAAAA,CAAQR,iBAAiB,CAACS,KAAAA,GAAAA;;QAE/BF,gBAAiBG,CAAAA,OAAO,CAAC,CAAChB,QAAAA,GAAAA;AACxB,YAAA,IAAI,CAACY,eAAAA,CAAgBK,QAAQ,CAACjB,QAAW,CAAA,EAAA;gBACvCe,KAAMlB,CAAAA,KAAK,CAACG,QAAAA,CAAS,GAAG;oBACtBC,WAAa,EAAA,CAAA;oBACbC,WAAa,EAAA,KAAA;oBACbC,QAAUC,EAAAA;AACZ,iBAAA;AACF;AACF,SAAA,CAAA;;QAGAQ,eAAgBI,CAAAA,OAAO,CAAC,CAAChB,QAAAA,GAAAA;AACvB,YAAA,IAAI,CAACa,gBAAAA,CAAiBI,QAAQ,CAACjB,QAAW,CAAA,EAAA;gBACxC,OAAOe,KAAAA,CAAMlB,KAAK,CAACG,QAAS,CAAA;AAC9B;AACF,SAAA,CAAA;AACF,KAAA,CAAA;AACF;;;;"}