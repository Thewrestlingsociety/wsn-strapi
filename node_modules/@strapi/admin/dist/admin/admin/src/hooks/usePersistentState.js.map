{"version":3,"file":"usePersistentState.js","sources":["../../../../../admin/src/hooks/usePersistentState.ts"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\n\nimport { useInitQuery } from '../services/admin';\n\nfunction readFromStorage<T>(key: string, fallback: T): T {\n  const raw = window.localStorage.getItem(key);\n  if (raw === null) return fallback;\n  try {\n    return JSON.parse(raw);\n  } catch {\n    // if primitive was stored\n    return raw as unknown as T;\n  }\n}\n\nconst usePersistentState = <T>(key: string, defaultValue: T) => {\n  const [value, setValue] = useState<T>(() => readFromStorage(key, defaultValue));\n\n  const currentKeyRef = useRef(key);\n\n  // when the key changes, re-hydrate from the new key\n  useEffect(() => {\n    if (currentKeyRef.current !== key) {\n      currentKeyRef.current = key;\n      setValue(readFromStorage(key, defaultValue));\n    }\n    // include defaultValue in case it changes across models\n  }, [key, defaultValue]);\n\n  // persist whenever (key, value) change â€” but only for the active key\n  useEffect(() => {\n    if (currentKeyRef.current !== key) return; // safety guard\n\n    window.localStorage.setItem(key, JSON.stringify(value));\n  }, [key, value]);\n\n  return [value, setValue] as const;\n};\n\n// Same as usePersistentState, but scoped to the current instance of Strapi\n// useful for storing state that should not be shared across different instances of Strapi running on localhost\nconst useScopedPersistentState = <T>(key: string, defaultValue: T) => {\n  const { data: initData } = useInitQuery();\n  const { uuid } = initData ?? {};\n\n  const namespacedKey = `${key}:${uuid}`;\n  return usePersistentState<T>(namespacedKey, defaultValue);\n};\n\nexport { usePersistentState, useScopedPersistentState };\n"],"names":["readFromStorage","key","fallback","raw","window","localStorage","getItem","JSON","parse","usePersistentState","defaultValue","value","setValue","useState","currentKeyRef","useRef","useEffect","current","setItem","stringify","useScopedPersistentState","data","initData","useInitQuery","uuid","namespacedKey"],"mappings":";;;;;AAIA,SAASA,eAAAA,CAAmBC,GAAW,EAAEC,QAAW,EAAA;AAClD,IAAA,MAAMC,GAAMC,GAAAA,MAAAA,CAAOC,YAAY,CAACC,OAAO,CAACL,GAAAA,CAAAA;IACxC,IAAIE,GAAAA,KAAQ,MAAM,OAAOD,QAAAA;IACzB,IAAI;QACF,OAAOK,IAAAA,CAAKC,KAAK,CAACL,GAAAA,CAAAA;AACpB,KAAA,CAAE,OAAM;;QAEN,OAAOA,GAAAA;AACT;AACF;AAEMM,MAAAA,kBAAAA,GAAqB,CAAIR,GAAaS,EAAAA,YAAAA,GAAAA;AAC1C,IAAA,MAAM,CAACC,KAAOC,EAAAA,QAAAA,CAAS,GAAGC,cAAY,CAAA,IAAMb,gBAAgBC,GAAKS,EAAAA,YAAAA,CAAAA,CAAAA;AAEjE,IAAA,MAAMI,gBAAgBC,YAAOd,CAAAA,GAAAA,CAAAA;;IAG7Be,eAAU,CAAA,IAAA;QACR,IAAIF,aAAAA,CAAcG,OAAO,KAAKhB,GAAK,EAAA;AACjCa,YAAAA,aAAAA,CAAcG,OAAO,GAAGhB,GAAAA;AACxBW,YAAAA,QAAAA,CAASZ,gBAAgBC,GAAKS,EAAAA,YAAAA,CAAAA,CAAAA;AAChC;;KAEC,EAAA;AAACT,QAAAA,GAAAA;AAAKS,QAAAA;AAAa,KAAA,CAAA;;IAGtBM,eAAU,CAAA,IAAA;AACR,QAAA,IAAIF,aAAcG,CAAAA,OAAO,KAAKhB,GAAAA,EAAK;AAEnCG,QAAAA,MAAAA,CAAOC,YAAY,CAACa,OAAO,CAACjB,GAAKM,EAAAA,IAAAA,CAAKY,SAAS,CAACR,KAAAA,CAAAA,CAAAA;KAC/C,EAAA;AAACV,QAAAA,GAAAA;AAAKU,QAAAA;AAAM,KAAA,CAAA;IAEf,OAAO;AAACA,QAAAA,KAAAA;AAAOC,QAAAA;AAAS,KAAA;AAC1B;AAEA;AACA;AACMQ,MAAAA,wBAAAA,GAA2B,CAAInB,GAAaS,EAAAA,YAAAA,GAAAA;AAChD,IAAA,MAAM,EAAEW,IAAAA,EAAMC,QAAQ,EAAE,GAAGC,kBAAAA,EAAAA;AAC3B,IAAA,MAAM,EAAEC,IAAI,EAAE,GAAGF,YAAY,EAAC;AAE9B,IAAA,MAAMG,aAAgB,GAAA,CAAA,EAAGxB,GAAI,CAAA,CAAC,EAAEuB,IAAM,CAAA,CAAA;AACtC,IAAA,OAAOf,mBAAsBgB,aAAef,EAAAA,YAAAA,CAAAA;AAC9C;;;;;"}