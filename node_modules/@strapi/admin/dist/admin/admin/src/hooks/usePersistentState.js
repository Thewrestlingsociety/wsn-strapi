'use strict';

var React = require('react');
var admin = require('../services/admin.js');

function readFromStorage(key, fallback) {
    const raw = window.localStorage.getItem(key);
    if (raw === null) return fallback;
    try {
        return JSON.parse(raw);
    } catch  {
        // if primitive was stored
        return raw;
    }
}
const usePersistentState = (key, defaultValue)=>{
    const [value, setValue] = React.useState(()=>readFromStorage(key, defaultValue));
    const currentKeyRef = React.useRef(key);
    // when the key changes, re-hydrate from the new key
    React.useEffect(()=>{
        if (currentKeyRef.current !== key) {
            currentKeyRef.current = key;
            setValue(readFromStorage(key, defaultValue));
        }
    // include defaultValue in case it changes across models
    }, [
        key,
        defaultValue
    ]);
    // persist whenever (key, value) change â€” but only for the active key
    React.useEffect(()=>{
        if (currentKeyRef.current !== key) return; // safety guard
        window.localStorage.setItem(key, JSON.stringify(value));
    }, [
        key,
        value
    ]);
    return [
        value,
        setValue
    ];
};
// Same as usePersistentState, but scoped to the current instance of Strapi
// useful for storing state that should not be shared across different instances of Strapi running on localhost
const useScopedPersistentState = (key, defaultValue)=>{
    const { data: initData } = admin.useInitQuery();
    const { uuid } = initData ?? {};
    const namespacedKey = `${key}:${uuid}`;
    return usePersistentState(namespacedKey, defaultValue);
};

exports.usePersistentState = usePersistentState;
exports.useScopedPersistentState = useScopedPersistentState;
//# sourceMappingURL=usePersistentState.js.map
