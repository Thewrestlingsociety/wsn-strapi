{"version":3,"file":"DocumentActions.js","sources":["../../../../../admin/src/pages/EditView/components/DocumentActions.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {\n  useForm,\n  useNotification,\n  NotificationConfig,\n  useAPIErrorHandler,\n  useQueryParams,\n  tours,\n  useGuidedTour,\n  GUIDED_TOUR_REQUIRED_ACTIONS,\n  useIsDesktop,\n} from '@strapi/admin/strapi-admin';\nimport {\n  Button,\n  Dialog,\n  Flex,\n  Modal,\n  Radio,\n  Typography,\n  Menu,\n  ButtonProps,\n  Tooltip,\n  IconButton,\n} from '@strapi/design-system';\nimport { Cross, More, WarningCircle } from '@strapi/icons';\nimport mapValues from 'lodash/fp/mapValues';\nimport get from 'lodash/get';\nimport merge from 'lodash/merge';\nimport set from 'lodash/set';\nimport { useIntl } from 'react-intl';\nimport { useMatch, useNavigate, useParams } from 'react-router-dom';\n\nimport { Create, Publish } from '../../../../../shared/contracts/collection-types';\nimport { PUBLISHED_AT_ATTRIBUTE_NAME } from '../../../constants/attributes';\nimport { SINGLE_TYPES } from '../../../constants/collections';\nimport { useDocumentRBAC } from '../../../features/DocumentRBAC';\nimport { useDoc, useDocument } from '../../../hooks/useDocument';\nimport { useDocumentActions } from '../../../hooks/useDocumentActions';\nimport { useDocumentContext } from '../../../hooks/useDocumentContext';\nimport { usePreviewContext } from '../../../preview/pages/Preview';\nimport { CLONE_PATH, LIST_PATH } from '../../../router';\nimport {\n  useGetDraftRelationCountQuery,\n  useUpdateDocumentMutation,\n} from '../../../services/documents';\nimport { isBaseQueryError, buildValidParams } from '../../../utils/api';\nimport { getTranslation } from '../../../utils/translations';\nimport { AnyData, handleInvisibleAttributes } from '../utils/data';\n\nimport { useRelationModal } from './FormInputs/Relations/RelationModal';\n\nimport type { RelationsFormValue } from './FormInputs/Relations/Relations';\nimport type { DocumentActionComponent } from '../../../content-manager';\n/* -------------------------------------------------------------------------------------------------\n * Types\n * -----------------------------------------------------------------------------------------------*/\ntype DocumentActionPosition = 'panel' | 'header' | 'table-row' | 'preview' | 'relation-modal';\n\ninterface DocumentActionDescription {\n  label: string;\n  onClick?: (event: React.SyntheticEvent) => Promise<boolean | void> | boolean | void;\n  icon?: React.ReactNode;\n  /**\n   * @default false\n   */\n  disabled?: boolean;\n  /**\n   * @default 'panel'\n   * @description Where the action should be rendered.\n   */\n  position?: DocumentActionPosition | DocumentActionPosition[];\n  dialog?: DialogOptions | NotificationOptions | ModalOptions;\n  /**\n   * @default 'secondary'\n   */\n  variant?: ButtonProps['variant'];\n  loading?: ButtonProps['loading'];\n}\n\ninterface DialogOptions {\n  type: 'dialog';\n  title: string;\n  content?: React.ReactNode;\n  variant?: ButtonProps['variant'];\n  onConfirm?: () => void | Promise<void>;\n  onCancel?: () => void | Promise<void>;\n}\n\ninterface NotificationOptions {\n  type: 'notification';\n  title: string;\n  link?: {\n    label: string;\n    url: string;\n    target?: string;\n  };\n  content?: string;\n  onClose?: () => void;\n  status?: NotificationConfig['type'];\n  timeout?: number;\n}\n\ninterface ModalOptions {\n  type: 'modal';\n  title: string;\n  content: React.ComponentType<{ onClose: () => void }> | React.ReactNode;\n  footer?: React.ComponentType<{ onClose: () => void }> | React.ReactNode;\n  onClose?: () => void;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * DocumentActions\n * -----------------------------------------------------------------------------------------------*/\n\ninterface Action extends DocumentActionDescription {\n  id: string;\n}\n\ninterface DocumentActionsProps {\n  actions: Action[];\n}\n\nconst connectRelationToParent = (\n  parentDataToUpdate: AnyData | undefined,\n  fieldToConnect: string,\n  data: Create.Response['data'] | Publish.Response['data'],\n  fieldToConnectUID?: string\n) => {\n  /*\n   * Check if the fieldToConnect is already present in the parentDataToUpdate.\n   * This happens in particular when in the parentDocument you have created\n   * a new component without saving.\n   */\n  const isFieldPresent = !!get(parentDataToUpdate, fieldToConnect);\n  const fieldToConnectPath = isFieldPresent\n    ? fieldToConnect\n    : // Compute the path to the parent object\n      fieldToConnect.split('.').slice(0, -1).join('.');\n  const fieldToConnectValue = isFieldPresent\n    ? {\n        connect: [\n          {\n            id: data.documentId,\n            documentId: data.documentId,\n            locale: data.locale,\n          },\n        ],\n      }\n    : {\n        [fieldToConnect.split('.').pop()!]: {\n          connect: [\n            {\n              id: data.documentId,\n              documentId: data.documentId,\n              locale: data.locale,\n            },\n          ],\n          disconnect: [],\n        },\n        // In case the object was not present you need to pass the componentUID of the parent document\n        __component: fieldToConnectUID,\n      };\n  const objectToConnect = set({}, fieldToConnectPath, fieldToConnectValue);\n  return merge(parentDataToUpdate, objectToConnect);\n};\n\nconst DocumentActions = ({ actions }: DocumentActionsProps) => {\n  const { formatMessage } = useIntl();\n  const isDesktop = useIsDesktop();\n  const [primaryAction, secondaryAction, ...restActions] = actions.filter((action) => {\n    if (action.position === undefined) {\n      return true;\n    }\n\n    const positions = Array.isArray(action.position) ? action.position : [action.position];\n    return positions.includes('panel');\n  });\n\n  if (!primaryAction) {\n    return null;\n  }\n\n  const addHintTooltip = (action: Action, children: React.ReactNode) => {\n    return !action.disabled ? (\n      <Tooltip\n        label={formatMessage(\n          {\n            id: 'content-manager.containers.EditView.saveHint',\n            defaultMessage: 'Ctrl / Cmd + Enter to {action}',\n          },\n          {\n            action: action.label,\n          }\n        )}\n      >\n        <Flex width=\"100%\">{children}</Flex>\n      </Tooltip>\n    ) : (\n      children\n    );\n  };\n\n  const primaryActionContent = (\n    <>\n      <Flex flex={1} alignItems=\"stretch\" direction=\"column\">\n        {primaryAction.label === 'Publish'\n          ? addHintTooltip(\n              primaryAction,\n              <DocumentActionButton\n                {...primaryAction}\n                variant={primaryAction.variant || 'default'}\n              />\n            )\n          : addHintTooltip(\n              primaryAction,\n              <DocumentActionButton\n                {...primaryAction}\n                variant={primaryAction.variant || 'default'}\n                buttonType=\"submit\"\n              />\n            )}\n      </Flex>\n\n      {restActions.length > 0 ? (\n        <DocumentActionsMenu\n          actions={restActions}\n          label={formatMessage({\n            id: 'content-manager.containers.edit.panels.default.more-actions',\n            defaultMessage: 'More document actions',\n          })}\n        />\n      ) : null}\n    </>\n  );\n\n  return (\n    <Flex direction={{ initial: 'row', large: 'column' }} gap={2} alignItems=\"stretch\" width=\"100%\">\n      <tours.contentManager.Publish>\n        {isDesktop ? <Flex gap={2}>{primaryActionContent}</Flex> : primaryActionContent}\n      </tours.contentManager.Publish>\n      {secondaryAction ? (\n        <Flex flex={1} order={{ initial: -1, large: 0 }} alignItems=\"stretch\" direction=\"column\">\n          {secondaryAction.label === 'Publish' ? (\n            <tours.contentManager.Publish>\n              <DocumentActionButton\n                {...secondaryAction}\n                variant={secondaryAction.variant || 'secondary'}\n              />\n            </tours.contentManager.Publish>\n          ) : (\n            <DocumentActionButton\n              {...secondaryAction}\n              variant={secondaryAction.variant || 'secondary'}\n              buttonType=\"submit\"\n            />\n          )}\n        </Flex>\n      ) : null}\n    </Flex>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DocumentActionButton\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DocumentActionButtonProps extends Action {\n  buttonType?: 'button' | 'submit' | 'reset';\n}\n\nconst DocumentActionButton = ({ buttonType = 'button', ...action }: DocumentActionButtonProps) => {\n  const [dialogId, setDialogId] = React.useState<string | null>(null);\n  const { toggleNotification } = useNotification();\n\n  const handleClick = (action: Action) => async (e: React.MouseEvent) => {\n    const { onClick = () => false, dialog, id } = action;\n\n    const muteDialog = await onClick(e);\n\n    if (dialog && !muteDialog) {\n      switch (dialog.type) {\n        case 'notification':\n          toggleNotification({\n            title: dialog.title,\n            message: dialog.content,\n            type: dialog.status,\n            timeout: dialog.timeout,\n            onClose: dialog.onClose,\n          });\n          break;\n        case 'dialog':\n        case 'modal':\n          e.preventDefault();\n          setDialogId(id);\n      }\n    }\n  };\n\n  const handleClose = () => {\n    setDialogId(null);\n  };\n\n  return (\n    <>\n      <Button\n        flex=\"auto\"\n        startIcon={action.icon}\n        disabled={action.disabled}\n        onClick={handleClick(action)}\n        justifyContent=\"center\"\n        variant={action.variant || 'default'}\n        paddingTop=\"7px\"\n        paddingBottom=\"7px\"\n        loading={action.loading}\n        type={buttonType}\n      >\n        {action.label}\n      </Button>\n      {action.dialog?.type === 'dialog' ? (\n        <DocumentActionConfirmDialog\n          {...action.dialog}\n          variant={action.dialog?.variant ?? action.variant}\n          isOpen={dialogId === action.id}\n          onClose={handleClose}\n        />\n      ) : null}\n      {action.dialog?.type === 'modal' ? (\n        <DocumentActionModal\n          {...action.dialog}\n          onModalClose={handleClose}\n          isOpen={dialogId === action.id}\n        />\n      ) : null}\n    </>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DocumentActionMenu\n * -----------------------------------------------------------------------------------------------*/\ninterface DocumentActionsMenuProps {\n  actions: Action[];\n  children?: React.ReactNode;\n  label?: string;\n  variant?: 'ghost' | 'tertiary';\n}\n\nconst DocumentActionsMenu = ({\n  actions,\n  children,\n  label,\n  variant = 'tertiary',\n}: DocumentActionsMenuProps) => {\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [dialogId, setDialogId] = React.useState<string | null>(null);\n  const { formatMessage } = useIntl();\n  const { toggleNotification } = useNotification();\n  const isDisabled = actions.every((action) => action.disabled) || actions.length === 0;\n  const triggerRef = React.useRef<HTMLButtonElement>(null);\n\n  const handleClick = (action: Action) => async (e: React.SyntheticEvent) => {\n    const { onClick = () => false, dialog, id } = action;\n\n    const muteDialog = await onClick(e);\n\n    if (dialog && !muteDialog) {\n      switch (dialog.type) {\n        case 'notification':\n          toggleNotification({\n            title: dialog.title,\n            message: dialog.content,\n            type: dialog.status,\n            timeout: dialog.timeout,\n            onClose: dialog.onClose,\n          });\n          break;\n        case 'dialog':\n        case 'modal':\n          setDialogId(id);\n      }\n    }\n  };\n\n  const handleClose = () => {\n    setDialogId(null);\n    setIsOpen(false);\n  };\n\n  const handleOpenChange = (open: boolean) => {\n    if (!isDisabled) {\n      setIsOpen(open);\n    }\n  };\n\n  return (\n    <Menu.Root open={isOpen} onOpenChange={handleOpenChange}>\n      <Menu.Trigger\n        ref={triggerRef}\n        disabled={isDisabled}\n        label={\n          label ||\n          formatMessage({\n            id: 'content-manager.containers.edit.panels.default.more-actions',\n            defaultMessage: 'More document actions',\n          })\n        }\n        tag={IconButton}\n        icon={<More />}\n        variant={variant}\n      />\n      <Menu.Content maxHeight={undefined} popoverPlacement=\"bottom-end\">\n        {actions.map((action) => {\n          return (\n            <Menu.Item\n              disabled={action.disabled}\n              /* @ts-expect-error â€“ TODO: this is an error in the DS where it is most likely a synthetic event, not regular. */\n              onSelect={handleClick(action)}\n              display=\"block\"\n              key={action.id}\n              variant={action.variant === 'danger' ? action.variant : 'default'}\n              startIcon={action.icon}\n            >\n              <Flex justifyContent=\"space-between\" gap={4}>\n                <Flex gap={2} tag=\"span\">\n                  {action.label}\n                </Flex>\n              </Flex>\n            </Menu.Item>\n          );\n        })}\n        {children}\n      </Menu.Content>\n      {actions.map((action) => {\n        return (\n          <React.Fragment key={action.id}>\n            {action.dialog?.type === 'dialog' ? (\n              <DocumentActionConfirmDialog\n                {...action.dialog}\n                variant={action.variant}\n                isOpen={dialogId === action.id}\n                onClose={handleClose}\n              />\n            ) : null}\n            {action.dialog?.type === 'modal' ? (\n              <DocumentActionModal\n                {...action.dialog}\n                onModalClose={handleClose}\n                isOpen={dialogId === action.id}\n              />\n            ) : null}\n          </React.Fragment>\n        );\n      })}\n    </Menu.Root>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DocumentActionConfirmDialog\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DocumentActionConfirmDialogProps extends DialogOptions, Pick<Action, 'variant'> {\n  onClose: () => void;\n  isOpen: Dialog.Props['open'];\n  loading?: ButtonProps['loading'];\n}\n\nconst DocumentActionConfirmDialog = ({\n  onClose,\n  onCancel,\n  onConfirm,\n  title,\n  content,\n  isOpen,\n  variant = 'secondary',\n  loading,\n}: DocumentActionConfirmDialogProps) => {\n  const { formatMessage } = useIntl();\n\n  const handleClose = async () => {\n    if (onCancel) {\n      await onCancel();\n    }\n\n    onClose();\n  };\n\n  const handleConfirm = async () => {\n    if (onConfirm) {\n      await onConfirm();\n    }\n\n    onClose();\n  };\n\n  return (\n    <Dialog.Root open={isOpen} onOpenChange={handleClose}>\n      <Dialog.Content>\n        <Dialog.Header>{title}</Dialog.Header>\n        <Dialog.Body>{content}</Dialog.Body>\n        <Dialog.Footer>\n          <Dialog.Cancel>\n            <Button variant=\"tertiary\" fullWidth>\n              {formatMessage({\n                id: 'app.components.Button.cancel',\n                defaultMessage: 'Cancel',\n              })}\n            </Button>\n          </Dialog.Cancel>\n          <Button onClick={handleConfirm} variant={variant} fullWidth loading={loading}>\n            {formatMessage({\n              id: 'app.components.Button.confirm',\n              defaultMessage: 'Confirm',\n            })}\n          </Button>\n        </Dialog.Footer>\n      </Dialog.Content>\n    </Dialog.Root>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DocumentActionModal\n * -----------------------------------------------------------------------------------------------*/\n\ninterface DocumentActionModalProps extends ModalOptions {\n  onModalClose: () => void;\n  isOpen?: boolean;\n}\n\nconst DocumentActionModal = ({\n  isOpen,\n  title,\n  onClose,\n  footer: Footer,\n  content: Content,\n  onModalClose,\n}: DocumentActionModalProps) => {\n  const handleClose = () => {\n    if (onClose) {\n      onClose();\n    }\n\n    onModalClose();\n  };\n\n  return (\n    <Modal.Root open={isOpen} onOpenChange={handleClose}>\n      <Modal.Content>\n        <Modal.Header>\n          <Modal.Title>{title}</Modal.Title>\n        </Modal.Header>\n        {typeof Content === 'function' ? (\n          <Content onClose={handleClose} />\n        ) : (\n          <Modal.Body>{Content}</Modal.Body>\n        )}\n        {typeof Footer === 'function' ? <Footer onClose={handleClose} /> : Footer}\n      </Modal.Content>\n    </Modal.Root>\n  );\n};\n\nconst transformData = (data: Record<string, any>): any => {\n  if (Array.isArray(data)) {\n    return data.map(transformData);\n  }\n\n  if (typeof data === 'object' && data !== null) {\n    if ('apiData' in data) {\n      return data.apiData;\n    }\n\n    return mapValues(transformData)(data);\n  }\n\n  return data;\n};\n\n/* -------------------------------------------------------------------------------------------------\n * DocumentActionComponents\n * -----------------------------------------------------------------------------------------------*/\n\nconst PublishAction: DocumentActionComponent = ({\n  activeTab,\n  documentId,\n  model,\n  collectionType,\n  meta,\n  document,\n}) => {\n  const {\n    currentDocument: { schema },\n  } = useDocumentContext('PublishAction');\n\n  const navigate = useNavigate();\n  const { toggleNotification } = useNotification();\n  const { _unstableFormatValidationErrors: formatValidationErrors } = useAPIErrorHandler();\n  const isListView = useMatch(LIST_PATH) !== null;\n  const isCloning = useMatch(CLONE_PATH) !== null;\n  const { id } = useParams();\n  const { formatMessage } = useIntl();\n  const { canPublish, canReadFields } = useDocumentRBAC(\n    'PublishAction',\n    ({ canPublish, canReadFields }) => ({ canPublish, canReadFields })\n  );\n  const { publish, isLoading } = useDocumentActions();\n  const onPreview = usePreviewContext('UpdateAction', (state) => state.onPreview, false);\n  const [\n    countDraftRelations,\n    { isLoading: isLoadingDraftRelations, isError: isErrorDraftRelations },\n  ] = useGetDraftRelationCountQuery();\n  const [localCountOfDraftRelations, setLocalCountOfDraftRelations] = React.useState(0);\n  const [serverCountOfDraftRelations, setServerCountOfDraftRelations] = React.useState(0);\n\n  const [{ rawQuery }] = useQueryParams();\n\n  const modified = useForm('PublishAction', ({ modified }) => modified);\n  const setSubmitting = useForm('PublishAction', ({ setSubmitting }) => setSubmitting);\n  const isSubmitting = useForm('PublishAction', ({ isSubmitting }) => isSubmitting);\n  const validate = useForm('PublishAction', (state) => state.validate);\n  const setErrors = useForm('PublishAction', (state) => state.setErrors);\n  const formValues = useForm('PublishAction', ({ values }) => values);\n  const initialValues = useForm('PublishAction', ({ initialValues }) => initialValues);\n  const resetForm = useForm('PublishAction', ({ resetForm }) => resetForm);\n  const {\n    currentDocument: { components },\n  } = useDocumentContext('PublishAction');\n\n  // need to discriminate if the publish is coming from a relation modal or in the edit view\n  const relationContext = useRelationModal('PublishAction', () => true, false);\n  const fromRelationModal = relationContext != undefined;\n\n  const dispatch = useRelationModal('PublishAction', (state) => state.dispatch);\n  const fieldToConnect = useRelationModal(\n    'PublishAction',\n    (state) => state.state.fieldToConnect,\n    false\n  );\n  const fieldToConnectUID = useRelationModal(\n    'PublishAction',\n    (state) => state.state.fieldToConnectUID,\n    false\n  );\n  const documentHistory = useRelationModal(\n    'PublishAction',\n    (state) => state.state.documentHistory,\n    false\n  );\n  const rootDocumentMeta = useRelationModal('PublishAction', (state) => state.rootDocumentMeta);\n\n  const dispatchGuidedTour = useGuidedTour('PublishAction', (s) => s.dispatch);\n\n  const { currentDocumentMeta } = useDocumentContext('PublishAction');\n  const [updateDocumentMutation] = useUpdateDocumentMutation();\n  const { _unstableFormatAPIError: formatAPIError } = useAPIErrorHandler();\n\n  const idToPublish = currentDocumentMeta.documentId || id;\n\n  React.useEffect(() => {\n    if (isErrorDraftRelations) {\n      toggleNotification({\n        type: 'danger',\n        message: formatMessage({\n          id: getTranslation('error.records.fetch-draft-relatons'),\n          defaultMessage: 'An error occurred while fetching draft relations on this document.',\n        }),\n      });\n    }\n  }, [isErrorDraftRelations, toggleNotification, formatMessage]);\n\n  React.useEffect(() => {\n    const localDraftRelations = new Set();\n\n    /**\n     * Extracts draft relations from the provided data object.\n     * It checks for a connect array of relations.\n     * If a relation has a status of 'draft', its id is added to the localDraftRelations set.\n     */\n    const extractDraftRelations = (data: Omit<RelationsFormValue, 'disconnect'>) => {\n      const relations = data.connect || [];\n      relations.forEach((relation) => {\n        if (relation.status === 'draft') {\n          localDraftRelations.add(relation.id);\n        }\n      });\n    };\n\n    /**\n     * Recursively traverses the provided data object to extract draft relations from arrays within 'connect' keys.\n     * If the data is an object, it looks for 'connect' keys to pass their array values to extractDraftRelations.\n     * It recursively calls itself for any non-null objects it contains.\n     */\n    const traverseAndExtract = (data: { [field: string]: any }) => {\n      Object.entries(data).forEach(([key, value]) => {\n        if (key === 'connect' && Array.isArray(value)) {\n          extractDraftRelations({ connect: value });\n        } else if (typeof value === 'object' && value !== null) {\n          traverseAndExtract(value);\n        }\n      });\n    };\n\n    if (!documentId || modified) {\n      traverseAndExtract(formValues);\n      setLocalCountOfDraftRelations(localDraftRelations.size);\n    }\n  }, [documentId, modified, formValues, setLocalCountOfDraftRelations]);\n\n  React.useEffect(() => {\n    if (!document || !document.documentId || isListView) {\n      return;\n    }\n\n    const fetchDraftRelationsCount = async () => {\n      const { data, error } = await countDraftRelations({\n        collectionType,\n        model,\n        documentId,\n        params: currentDocumentMeta.params,\n      });\n\n      if (error) {\n        throw error;\n      }\n\n      if (data) {\n        setServerCountOfDraftRelations(data.data);\n      }\n    };\n\n    fetchDraftRelationsCount();\n  }, [\n    isListView,\n    document,\n    documentId,\n    countDraftRelations,\n    collectionType,\n    model,\n    currentDocumentMeta.params,\n  ]);\n  const parentDocumentMetaToUpdate = documentHistory?.at(-2) ?? rootDocumentMeta;\n  const parentDocumentData = useDocument(\n    {\n      documentId: parentDocumentMetaToUpdate?.documentId,\n      model: parentDocumentMetaToUpdate?.model,\n      collectionType: parentDocumentMetaToUpdate?.collectionType,\n      params: parentDocumentMetaToUpdate?.params,\n    },\n    { skip: !parentDocumentMetaToUpdate }\n  );\n  const { getInitialFormValues } = useDoc();\n\n  const isDocumentPublished =\n    (document?.[PUBLISHED_AT_ATTRIBUTE_NAME] ||\n      meta?.availableStatus.some((doc) => doc[PUBLISHED_AT_ATTRIBUTE_NAME] !== null)) &&\n    document?.status !== 'modified';\n\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const performPublish = async () => {\n    setSubmitting(true);\n\n    try {\n      const { data: filteredData } = handleInvisibleAttributes(transformData(formValues), {\n        schema,\n        components,\n      });\n      const { errors } = await validate(true, {\n        ...filteredData,\n        status: 'published',\n      });\n      if (errors) {\n        const hasUnreadableRequiredField =\n          schema &&\n          Object.keys(schema.attributes).some((fieldName) => {\n            const attribute = schema.attributes[fieldName];\n\n            // For components, check if any of the component fields are readable\n            if (attribute.type === 'component') {\n              const componentFields = (canReadFields ?? []).filter((field) =>\n                field.startsWith(`${fieldName}.`)\n              );\n              return componentFields.length === 0;\n            }\n\n            // For regular fields, check if the field itself is readable\n            return attribute?.required && !(canReadFields ?? []).includes(fieldName);\n          });\n\n        if (hasUnreadableRequiredField) {\n          toggleNotification({\n            type: 'danger',\n            message: formatMessage({\n              id: 'content-manager.validation.error.unreadable-required-field',\n              defaultMessage:\n                'Your current permissions prevent access to certain required fields. Please request access from an administrator to proceed.',\n            }),\n          });\n        } else {\n          toggleNotification({\n            type: 'danger',\n            message: formatMessage({\n              id: 'content-manager.validation.error',\n              defaultMessage:\n                'There are validation errors in your document. Please fix them before saving.',\n            }),\n          });\n        }\n        return;\n      }\n      // filteredData is already used for validation, so use it for publishing as well\n      const data = filteredData;\n      const res = await publish(\n        {\n          collectionType,\n          model,\n          documentId,\n          params: currentDocumentMeta.params,\n        },\n        data\n      );\n\n      // Reset form with current values as new initial values (clears errors/submitting and sets modified to false)\n      if ('data' in res) {\n        resetForm(formValues);\n        dispatchGuidedTour({\n          type: 'set_completed_actions',\n          payload: [GUIDED_TOUR_REQUIRED_ACTIONS.contentManager.createContent],\n        });\n      }\n\n      if ('data' in res && collectionType !== SINGLE_TYPES) {\n        /**\n         * TODO: refactor the router so we can just do `../${res.data.documentId}` instead of this.\n         */\n        if (idToPublish === 'create' && !fromRelationModal) {\n          navigate({\n            pathname: `../${collectionType}/${model}/${res.data.documentId}`,\n            search: rawQuery,\n          });\n        } else if (fromRelationModal) {\n          const newRelation = {\n            documentId: res.data.documentId,\n            collectionType,\n            model,\n            params: currentDocumentMeta.params,\n          };\n\n          /*\n           * Update, if needed, the parent relation with the newly published document.\n           * Check if in history we have the parent relation otherwise use the\n           * rootDocument\n           */\n          if (\n            fieldToConnect &&\n            documentHistory &&\n            (parentDocumentMetaToUpdate.documentId ||\n              parentDocumentMetaToUpdate.collectionType === SINGLE_TYPES)\n          ) {\n            const parentDataToUpdate =\n              parentDocumentMetaToUpdate.collectionType === SINGLE_TYPES\n                ? getInitialFormValues()\n                : parentDocumentData.getInitialFormValues();\n            const metaDocumentToUpdate = documentHistory.at(-2) ?? rootDocumentMeta;\n\n            const dataToUpdate = connectRelationToParent(\n              parentDataToUpdate,\n              fieldToConnect,\n              res.data,\n              fieldToConnectUID\n            );\n\n            try {\n              const updateRes = await updateDocumentMutation({\n                collectionType: metaDocumentToUpdate.collectionType,\n                model: metaDocumentToUpdate.model,\n                documentId:\n                  metaDocumentToUpdate.collectionType !== SINGLE_TYPES\n                    ? metaDocumentToUpdate.documentId\n                    : undefined,\n                params: metaDocumentToUpdate.params,\n                data: dataToUpdate,\n              });\n\n              if ('error' in updateRes) {\n                toggleNotification({ type: 'danger', message: formatAPIError(updateRes.error) });\n                return;\n              }\n            } catch (err) {\n              toggleNotification({\n                type: 'danger',\n                message: formatMessage({\n                  id: 'notification.error',\n                  defaultMessage: 'An error occurred',\n                }),\n              });\n\n              throw err;\n            }\n          }\n\n          dispatch({\n            type: 'GO_TO_CREATED_RELATION',\n            payload: { document: newRelation, shouldBypassConfirmation: true },\n          });\n        }\n      } else if (\n        'error' in res &&\n        isBaseQueryError(res.error) &&\n        res.error.name === 'ValidationError'\n      ) {\n        setErrors(formatValidationErrors(res.error));\n      }\n    } finally {\n      setSubmitting(false);\n      if (onPreview) {\n        onPreview();\n      }\n    }\n  };\n\n  const totalDraftRelations = localCountOfDraftRelations + serverCountOfDraftRelations;\n  // TODO skipping this for now as there is a bug with the draft relation count that will be worked on separately\n  // see RFC \"Count draft relations\" in Notion\n  const enableDraftRelationsCount = false;\n  const hasDraftRelations = enableDraftRelationsCount && totalDraftRelations > 0;\n\n  // Auto-publish on CMD+Enter on macOS, and CTRL+Enter on Windows/Linux\n  React.useEffect(() => {\n    if (!schema?.options?.draftAndPublish) {\n      return;\n    }\n\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n        e.preventDefault();\n        if (!hasDraftRelations) {\n          performPublish();\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [hasDraftRelations, performPublish, schema?.options?.draftAndPublish]);\n\n  if (!schema?.options?.draftAndPublish) {\n    return null;\n  }\n\n  return {\n    loading: isLoading,\n    position: ['panel', 'preview', 'relation-modal'],\n    /**\n     * Disabled when:\n     *  - currently if you're cloning a document we don't support publish & clone at the same time.\n     *  - the form is submitting\n     *  - the active tab is the published tab\n     *  - the document is already published & not modified\n     *  - the document is being created & not modified\n     *  - the user doesn't have the permission to publish\n     */\n    disabled:\n      isCloning ||\n      isSubmitting ||\n      isLoadingDraftRelations ||\n      activeTab === 'published' ||\n      (!modified && isDocumentPublished) ||\n      (!modified && !document?.documentId) ||\n      !canPublish,\n    label: formatMessage({\n      id: 'app.utils.publish',\n      defaultMessage: 'Publish',\n    }),\n    onClick: async () => {\n      if (hasDraftRelations) {\n        // In this case we need to show the user a confirmation dialog.\n        // Return from the onClick and let the dialog handle the process.\n        return;\n      }\n\n      await performPublish();\n    },\n    dialog: hasDraftRelations\n      ? {\n          type: 'dialog',\n          variant: 'danger',\n          footer: null,\n          title: formatMessage({\n            id: getTranslation(`popUpwarning.warning.bulk-has-draft-relations.title`),\n            defaultMessage: 'Confirmation',\n          }),\n          content: formatMessage(\n            {\n              id: getTranslation(`popUpwarning.warning.bulk-has-draft-relations.message`),\n              defaultMessage:\n                'This entry is related to {count, plural, one {# draft entry} other {# draft entries}}. Publishing it could leave broken links in your app.',\n            },\n            {\n              count: totalDraftRelations,\n            }\n          ),\n          onConfirm: async () => {\n            await performPublish();\n          },\n        }\n      : undefined,\n  };\n};\n\nPublishAction.type = 'publish';\nPublishAction.position = ['panel', 'preview', 'relation-modal'];\n\nconst UpdateAction: DocumentActionComponent = ({\n  activeTab,\n  documentId,\n  model,\n  collectionType,\n}) => {\n  const dispatchGuidedTour = useGuidedTour('UpdateAction', (s) => s.dispatch);\n  const navigate = useNavigate();\n  const { toggleNotification } = useNotification();\n  const { _unstableFormatValidationErrors: formatValidationErrors } = useAPIErrorHandler();\n  const cloneMatch = useMatch(CLONE_PATH);\n  const isCloning = cloneMatch !== null;\n  const { formatMessage } = useIntl();\n  const { create, update, clone, isLoading } = useDocumentActions();\n  const {\n    currentDocument: { components },\n  } = useDocumentContext('UpdateAction');\n  const [{ rawQuery }] = useQueryParams();\n  const onPreview = usePreviewContext('UpdateAction', (state) => state.onPreview, false);\n  const { getInitialFormValues } = useDoc();\n\n  const isSubmitting = useForm('UpdateAction', ({ isSubmitting }) => isSubmitting);\n  const modified = useForm('UpdateAction', ({ modified }) => modified);\n  const setSubmitting = useForm('UpdateAction', ({ setSubmitting }) => setSubmitting);\n  const initialValues = useForm('UpdateAction', ({ initialValues }) => initialValues);\n  const document = useForm('UpdateAction', ({ values }) => values);\n  const validate = useForm('UpdateAction', (state) => state.validate);\n  const setErrors = useForm('UpdateAction', (state) => state.setErrors);\n  const resetForm = useForm('UpdateAction', ({ resetForm }) => resetForm);\n\n  const dispatch = useRelationModal('UpdateAction', (state) => state.dispatch);\n\n  // need to discriminate if the update is coming from a relation modal or in the edit view\n  const relationContext = useRelationModal('UpdateAction', () => true, false);\n  const relationalModalSchema = useRelationModal(\n    'UpdateAction',\n    (state) => state.currentDocument.schema,\n    false\n  );\n  const fieldToConnect = useRelationModal(\n    'UpdateAction',\n    (state) => state.state.fieldToConnect,\n    false\n  );\n  const fieldToConnectUID = useRelationModal(\n    'PublishAction',\n    (state) => state.state.fieldToConnectUID,\n    false\n  );\n  const documentHistory = useRelationModal(\n    'UpdateAction',\n    (state) => state.state.documentHistory,\n    false\n  );\n  const rootDocumentMeta = useRelationModal('UpdateAction', (state) => state.rootDocumentMeta);\n  const fromRelationModal = relationContext != undefined;\n\n  const { currentDocumentMeta } = useDocumentContext('UpdateAction');\n  const [updateDocumentMutation] = useUpdateDocumentMutation();\n  const { _unstableFormatAPIError: formatAPIError } = useAPIErrorHandler();\n  const parentDocumentMetaToUpdate = documentHistory?.at(-2) ?? rootDocumentMeta;\n  const parentDocumentData = useDocument(\n    {\n      documentId: parentDocumentMetaToUpdate?.documentId,\n      model: parentDocumentMetaToUpdate?.model,\n      collectionType: parentDocumentMetaToUpdate?.collectionType,\n      params: parentDocumentMetaToUpdate?.params,\n    },\n    { skip: !parentDocumentMetaToUpdate }\n  );\n  const { schema } = useDoc();\n\n  const handleUpdate = async () => {\n    setSubmitting(true);\n\n    try {\n      if (!modified) {\n        return;\n      }\n\n      const { errors } = await validate(true, {\n        status: 'draft',\n      });\n\n      if (errors) {\n        toggleNotification({\n          type: 'danger',\n          message: formatMessage({\n            id: 'content-manager.validation.error',\n            defaultMessage:\n              'There are validation errors in your document. Please fix them before saving.',\n          }),\n        });\n\n        return;\n      }\n      if (isCloning) {\n        const res = await clone(\n          {\n            model,\n            documentId: cloneMatch.params.origin!,\n            params: currentDocumentMeta.params,\n          },\n          transformData(document)\n        );\n\n        if ('data' in res) {\n          navigate(\n            {\n              pathname: `../${res.data.documentId}`,\n              search: rawQuery,\n            },\n            { relative: 'path' }\n          );\n        } else if (\n          'error' in res &&\n          isBaseQueryError(res.error) &&\n          res.error.name === 'ValidationError'\n        ) {\n          setErrors(formatValidationErrors(res.error));\n        }\n      } else if (documentId || collectionType === SINGLE_TYPES) {\n        const { data } = handleInvisibleAttributes(transformData(document), {\n          schema: fromRelationModal ? relationalModalSchema : schema,\n          initialValues,\n          components,\n        });\n        const res = await update(\n          {\n            collectionType,\n            model,\n            documentId,\n            params: currentDocumentMeta.params,\n          },\n          data\n        );\n\n        if ('error' in res && isBaseQueryError(res.error) && res.error.name === 'ValidationError') {\n          setErrors(formatValidationErrors(res.error));\n        } else {\n          resetForm(document);\n        }\n      } else {\n        const { data } = handleInvisibleAttributes(transformData(document), {\n          schema: fromRelationModal ? relationalModalSchema : schema,\n          initialValues,\n          components,\n        });\n        const res = await create(\n          {\n            model,\n            params: currentDocumentMeta.params,\n          },\n          data\n        );\n\n        if ('data' in res && collectionType !== SINGLE_TYPES) {\n          if (fromRelationModal) {\n            const createdRelation = {\n              documentId: res.data.documentId,\n              collectionType,\n              model,\n              params: currentDocumentMeta.params,\n            };\n            /*\n             * Update, if needed, the parent relation with the newly published document.\n             * Check if in history we have the parent relation otherwise use the\n             * rootDocument\n             */\n            if (\n              fieldToConnect &&\n              documentHistory &&\n              (parentDocumentMetaToUpdate.documentId ||\n                parentDocumentMetaToUpdate.collectionType === SINGLE_TYPES)\n            ) {\n              const parentDataToUpdate =\n                parentDocumentMetaToUpdate.collectionType === SINGLE_TYPES\n                  ? getInitialFormValues()\n                  : parentDocumentData.getInitialFormValues();\n\n              const dataToUpdate = connectRelationToParent(\n                parentDataToUpdate,\n                fieldToConnect,\n                res.data,\n                fieldToConnectUID\n              );\n\n              try {\n                const updateRes = await updateDocumentMutation({\n                  collectionType: parentDocumentMetaToUpdate.collectionType,\n                  model: parentDocumentMetaToUpdate.model,\n                  documentId:\n                    parentDocumentMetaToUpdate.collectionType !== SINGLE_TYPES\n                      ? parentDocumentMetaToUpdate.documentId\n                      : undefined,\n                  params: parentDocumentMetaToUpdate.params,\n                  data: {\n                    ...dataToUpdate,\n                  },\n                });\n                if ('error' in updateRes) {\n                  toggleNotification({ type: 'danger', message: formatAPIError(updateRes.error) });\n                  return;\n                }\n              } catch (err) {\n                toggleNotification({\n                  type: 'danger',\n                  message: formatMessage({\n                    id: 'notification.error',\n                    defaultMessage: 'An error occurred',\n                  }),\n                });\n\n                throw err;\n              }\n            }\n\n            dispatch({\n              type: 'GO_TO_CREATED_RELATION',\n              payload: { document: createdRelation, shouldBypassConfirmation: true },\n            });\n          } else {\n            navigate(\n              {\n                pathname: `../${res.data.documentId}`,\n                search: rawQuery,\n              },\n              { replace: true, relative: 'path' }\n            );\n          }\n        } else if (\n          'error' in res &&\n          isBaseQueryError(res.error) &&\n          res.error.name === 'ValidationError'\n        ) {\n          setErrors(formatValidationErrors(res.error));\n        }\n      }\n    } finally {\n      dispatchGuidedTour({\n        type: 'set_completed_actions',\n        payload: [GUIDED_TOUR_REQUIRED_ACTIONS.contentManager.createContent],\n      });\n      setSubmitting(false);\n      if (onPreview) {\n        onPreview();\n      }\n    }\n  };\n\n  return {\n    loading: isLoading,\n    /**\n     * Disabled when:\n     * - the form is submitting\n     * - the document is not modified & we're not cloning (you can save a clone entity straight away)\n     * - the active tab is the published tab\n     */\n    disabled: isSubmitting || (!modified && !isCloning) || activeTab === 'published',\n    label: formatMessage({\n      id: 'global.save',\n      defaultMessage: 'Save',\n    }),\n    onClick: handleUpdate,\n    position: ['panel', 'preview', 'relation-modal'],\n  };\n};\n\nUpdateAction.type = 'update';\nUpdateAction.position = ['panel', 'preview', 'relation-modal'];\n\nconst UNPUBLISH_DRAFT_OPTIONS = {\n  KEEP: 'keep',\n  DISCARD: 'discard',\n};\n\nconst UnpublishAction: DocumentActionComponent = ({\n  activeTab,\n  documentId,\n  model,\n  collectionType,\n  document,\n}) => {\n  const { formatMessage } = useIntl();\n  const { schema } = useDoc();\n  const canPublish = useDocumentRBAC('UnpublishAction', ({ canPublish }) => canPublish);\n  const { unpublish } = useDocumentActions();\n  const [{ query }] = useQueryParams();\n  const params = React.useMemo(() => buildValidParams(query), [query]);\n  const { toggleNotification } = useNotification();\n  const [shouldKeepDraft, setShouldKeepDraft] = React.useState(true);\n\n  const isDocumentModified = document?.status === 'modified';\n\n  const handleChange = (value: string) => {\n    setShouldKeepDraft(value === UNPUBLISH_DRAFT_OPTIONS.KEEP);\n  };\n\n  if (!schema?.options?.draftAndPublish) {\n    return null;\n  }\n\n  return {\n    disabled:\n      !canPublish ||\n      activeTab === 'published' ||\n      (document?.status !== 'published' && document?.status !== 'modified'),\n    label: formatMessage({\n      id: 'app.utils.unpublish',\n      defaultMessage: 'Unpublish',\n    }),\n    icon: <Cross />,\n    onClick: async () => {\n      /**\n       * return if there's no id & we're in a collection type, or the status modified\n       * for either collection type because we use a dialog to handle the process in\n       * the latter case.\n       */\n      if ((!documentId && collectionType !== SINGLE_TYPES) || isDocumentModified) {\n        if (!documentId) {\n          // This should never, ever, happen.\n          console.error(\n            \"You're trying to unpublish a document without an id, this is likely a bug with Strapi. Please open an issue.\"\n          );\n\n          toggleNotification({\n            message: formatMessage({\n              id: 'content-manager.actions.unpublish.error',\n              defaultMessage: 'An error occurred while trying to unpublish the document.',\n            }),\n            type: 'danger',\n          });\n        }\n\n        return;\n      }\n\n      await unpublish({\n        collectionType,\n        model,\n        documentId,\n        params,\n      });\n    },\n    dialog: isDocumentModified\n      ? {\n          type: 'dialog',\n          title: formatMessage({\n            id: 'app.components.ConfirmDialog.title',\n            defaultMessage: 'Confirmation',\n          }),\n          content: (\n            <Flex alignItems=\"flex-start\" direction=\"column\" gap={6}>\n              <Flex width=\"100%\" direction=\"column\" gap={2}>\n                <WarningCircle width=\"24px\" height=\"24px\" fill=\"danger600\" />\n                <Typography tag=\"p\" variant=\"omega\" textAlign=\"center\">\n                  {formatMessage({\n                    id: 'content-manager.actions.unpublish.dialog.body',\n                    defaultMessage: 'Are you sure?',\n                  })}\n                </Typography>\n              </Flex>\n              <Radio.Group\n                defaultValue={UNPUBLISH_DRAFT_OPTIONS.KEEP}\n                name=\"discard-options\"\n                aria-label={formatMessage({\n                  id: 'content-manager.actions.unpublish.dialog.radio-label',\n                  defaultMessage: 'Choose an option to unpublish the document.',\n                })}\n                onValueChange={handleChange}\n              >\n                <Radio.Item checked={shouldKeepDraft} value={UNPUBLISH_DRAFT_OPTIONS.KEEP}>\n                  {formatMessage({\n                    id: 'content-manager.actions.unpublish.dialog.option.keep-draft',\n                    defaultMessage: 'Keep draft',\n                  })}\n                </Radio.Item>\n                <Radio.Item checked={!shouldKeepDraft} value={UNPUBLISH_DRAFT_OPTIONS.DISCARD}>\n                  {formatMessage({\n                    id: 'content-manager.actions.unpublish.dialog.option.replace-draft',\n                    defaultMessage: 'Replace draft',\n                  })}\n                </Radio.Item>\n              </Radio.Group>\n            </Flex>\n          ),\n          onConfirm: async () => {\n            if (!documentId && collectionType !== SINGLE_TYPES) {\n              // This should never, ever, happen.\n              console.error(\n                \"You're trying to unpublish a document without an id, this is likely a bug with Strapi. Please open an issue.\"\n              );\n\n              toggleNotification({\n                message: formatMessage({\n                  id: 'content-manager.actions.unpublish.error',\n                  defaultMessage: 'An error occurred while trying to unpublish the document.',\n                }),\n                type: 'danger',\n              });\n            }\n\n            await unpublish(\n              {\n                collectionType,\n                model,\n                documentId,\n                params,\n              },\n              !shouldKeepDraft\n            );\n          },\n        }\n      : undefined,\n    variant: 'danger',\n    position: ['panel', 'table-row'],\n  };\n};\n\nUnpublishAction.type = 'unpublish';\nUnpublishAction.position = 'panel';\n\nconst DiscardAction: DocumentActionComponent = ({\n  activeTab,\n  documentId,\n  model,\n  collectionType,\n  document,\n}) => {\n  const { formatMessage } = useIntl();\n  const { schema } = useDoc();\n  const canUpdate = useDocumentRBAC('DiscardAction', ({ canUpdate }) => canUpdate);\n  const { discard, isLoading } = useDocumentActions();\n  const [{ query }] = useQueryParams();\n  const params = React.useMemo(() => buildValidParams(query), [query]);\n\n  if (!schema?.options?.draftAndPublish) {\n    return null;\n  }\n\n  return {\n    disabled: !canUpdate || activeTab === 'published' || document?.status !== 'modified',\n    label: formatMessage({\n      id: 'content-manager.actions.discard.label',\n      defaultMessage: 'Discard changes',\n    }),\n    icon: <Cross />,\n    position: ['panel', 'table-row'],\n    variant: 'danger',\n    dialog: {\n      type: 'dialog',\n      title: formatMessage({\n        id: 'app.components.ConfirmDialog.title',\n        defaultMessage: 'Confirmation',\n      }),\n      content: (\n        <Flex direction=\"column\" gap={2}>\n          <WarningCircle width=\"24px\" height=\"24px\" fill=\"danger600\" />\n          <Typography tag=\"p\" variant=\"omega\" textAlign=\"center\">\n            {formatMessage({\n              id: 'content-manager.actions.discard.dialog.body',\n              defaultMessage: 'Are you sure?',\n            })}\n          </Typography>\n        </Flex>\n      ),\n      loading: isLoading,\n      onConfirm: async () => {\n        await discard({\n          collectionType,\n          model,\n          documentId,\n          params,\n        });\n      },\n    },\n  };\n};\n\nDiscardAction.type = 'discard';\nDiscardAction.position = 'panel';\n\nconst DEFAULT_ACTIONS = [PublishAction, UpdateAction, UnpublishAction, DiscardAction];\n\nexport { DocumentActions, DocumentActionsMenu, DocumentActionButton, DEFAULT_ACTIONS };\nexport type {\n  DocumentActionDescription,\n  DocumentActionPosition,\n  DialogOptions,\n  NotificationOptions,\n  ModalOptions,\n};\n"],"names":["connectRelationToParent","parentDataToUpdate","fieldToConnect","data","fieldToConnectUID","isFieldPresent","get","fieldToConnectPath","split","slice","join","fieldToConnectValue","connect","id","documentId","locale","pop","disconnect","__component","objectToConnect","set","merge","DocumentActions","actions","formatMessage","useIntl","isDesktop","useIsDesktop","primaryAction","secondaryAction","restActions","filter","action","position","undefined","positions","Array","isArray","includes","addHintTooltip","children","disabled","_jsx","Tooltip","label","defaultMessage","Flex","width","primaryActionContent","_jsxs","_Fragment","flex","alignItems","direction","DocumentActionButton","variant","buttonType","length","DocumentActionsMenu","initial","large","gap","tours","contentManager","Publish","order","dialogId","setDialogId","React","useState","toggleNotification","useNotification","handleClick","e","onClick","dialog","muteDialog","type","title","message","content","status","timeout","onClose","preventDefault","handleClose","Button","startIcon","icon","justifyContent","paddingTop","paddingBottom","loading","DocumentActionConfirmDialog","isOpen","DocumentActionModal","onModalClose","setIsOpen","isDisabled","every","triggerRef","useRef","handleOpenChange","open","Menu","Root","onOpenChange","Trigger","ref","tag","IconButton","More","Content","maxHeight","popoverPlacement","map","Item","onSelect","display","Fragment","onCancel","onConfirm","handleConfirm","Dialog","Header","Body","Footer","Cancel","fullWidth","footer","Modal","Title","transformData","apiData","mapValues","PublishAction","activeTab","model","collectionType","meta","document","currentDocument","schema","useDocumentContext","navigate","useNavigate","_unstableFormatValidationErrors","formatValidationErrors","useAPIErrorHandler","isListView","useMatch","LIST_PATH","isCloning","CLONE_PATH","useParams","canPublish","canReadFields","useDocumentRBAC","publish","isLoading","useDocumentActions","onPreview","usePreviewContext","state","countDraftRelations","isLoadingDraftRelations","isError","isErrorDraftRelations","useGetDraftRelationCountQuery","localCountOfDraftRelations","setLocalCountOfDraftRelations","serverCountOfDraftRelations","setServerCountOfDraftRelations","rawQuery","useQueryParams","modified","useForm","setSubmitting","isSubmitting","validate","setErrors","formValues","values","initialValues","resetForm","components","relationContext","useRelationModal","fromRelationModal","dispatch","documentHistory","rootDocumentMeta","dispatchGuidedTour","useGuidedTour","s","currentDocumentMeta","updateDocumentMutation","useUpdateDocumentMutation","_unstableFormatAPIError","formatAPIError","idToPublish","useEffect","getTranslation","localDraftRelations","Set","extractDraftRelations","relations","forEach","relation","add","traverseAndExtract","Object","entries","key","value","size","fetchDraftRelationsCount","error","params","parentDocumentMetaToUpdate","at","parentDocumentData","useDocument","skip","getInitialFormValues","useDoc","isDocumentPublished","PUBLISHED_AT_ATTRIBUTE_NAME","availableStatus","some","doc","performPublish","filteredData","handleInvisibleAttributes","errors","hasUnreadableRequiredField","keys","attributes","fieldName","attribute","componentFields","field","startsWith","required","res","payload","GUIDED_TOUR_REQUIRED_ACTIONS","createContent","SINGLE_TYPES","pathname","search","newRelation","metaDocumentToUpdate","dataToUpdate","updateRes","err","shouldBypassConfirmation","isBaseQueryError","name","totalDraftRelations","enableDraftRelationsCount","hasDraftRelations","options","draftAndPublish","handleKeyDown","metaKey","ctrlKey","window","addEventListener","removeEventListener","count","UpdateAction","cloneMatch","create","update","clone","relationalModalSchema","handleUpdate","origin","relative","createdRelation","replace","UNPUBLISH_DRAFT_OPTIONS","KEEP","DISCARD","UnpublishAction","unpublish","query","useMemo","buildValidParams","shouldKeepDraft","setShouldKeepDraft","isDocumentModified","handleChange","Cross","console","WarningCircle","height","fill","Typography","textAlign","Radio","Group","defaultValue","aria-label","onValueChange","checked","DiscardAction","canUpdate","discard","DEFAULT_ACTIONS"],"mappings":"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"}