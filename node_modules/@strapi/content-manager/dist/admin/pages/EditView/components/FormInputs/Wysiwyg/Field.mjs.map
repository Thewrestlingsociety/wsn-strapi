{"version":3,"file":"Field.mjs","sources":["../../../../../../../admin/src/pages/EditView/components/FormInputs/Wysiwyg/Field.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport { useField, useStrapiApp, useIsMobile, type InputProps } from '@strapi/admin/strapi-admin';\nimport { Box, Field, Flex } from '@strapi/design-system';\nimport { EditorFromTextArea } from 'codemirror5';\n\nimport { prefixFileUrlWithBackendUrl } from '../../../../../utils/urls';\n\nimport { Editor, EditorApi } from './Editor';\nimport { EditorLayout } from './EditorLayout';\nimport { insertFile } from './utils/utils';\nimport { WysiwygFooter } from './WysiwygFooter';\nimport { WysiwygNav, WysiwygPreviewToggleButton } from './WysiwygNav';\n\nimport type { Schema } from '@strapi/types';\n\ninterface WysiwygProps extends Omit<InputProps, 'type'> {\n  labelAction?: React.ReactNode;\n  type: Schema.Attribute.RichText['type'];\n}\n\nconst Wysiwyg = React.forwardRef<EditorApi, WysiwygProps>(\n  ({ hint, disabled, label, name, placeholder, required, labelAction }, forwardedRef) => {\n    const field = useField(name);\n    const textareaRef = React.useRef<HTMLTextAreaElement>(null);\n    const editorRef = React.useRef<EditorFromTextArea>(\n      null\n    ) as React.MutableRefObject<EditorFromTextArea>;\n    const [isPreviewMode, setIsPreviewMode] = React.useState(false);\n    const [mediaLibVisible, setMediaLibVisible] = React.useState(false);\n    const [isExpandMode, setIsExpandMode] = React.useState(false);\n    const isMobile = useIsMobile();\n    const components = useStrapiApp('ImageDialog', (state) => state.components);\n\n    const MediaLibraryDialog = components['media-library'];\n\n    const handleToggleMediaLib = () => setMediaLibVisible((prev) => !prev);\n    const handleTogglePreviewMode = () => setIsPreviewMode((prev) => !prev);\n    const handleToggleExpand = () => {\n      setIsPreviewMode(false);\n      setIsExpandMode((prev) => !prev);\n    };\n\n    const handleSelectAssets = (files: any[]) => {\n      const formattedFiles = files.map((f) => ({\n        alt: f.alternativeText || f.name,\n        url: prefixFileUrlWithBackendUrl(f.url),\n        mime: f.mime,\n      }));\n\n      insertFile(editorRef, formattedFiles);\n      setMediaLibVisible(false);\n    };\n\n    return (\n      <Field.Root name={name} hint={hint} error={field.error} required={required}>\n        <Flex direction=\"column\" alignItems=\"stretch\" gap={1}>\n          <Field.Label action={labelAction}>{label}</Field.Label>\n          <EditorLayout\n            isExpandMode={isExpandMode}\n            error={field.error}\n            previewContent={field.value}\n            onCollapse={handleToggleExpand}\n          >\n            <WysiwygNav\n              isExpandMode={isExpandMode}\n              editorRef={editorRef}\n              isPreviewMode={isPreviewMode}\n              onToggleMediaLib={handleToggleMediaLib}\n              onTogglePreviewMode={isExpandMode ? undefined : handleTogglePreviewMode}\n              disabled={disabled}\n            />\n            <Editor\n              disabled={disabled}\n              isExpandMode={isExpandMode}\n              editorRef={editorRef}\n              error={field.error}\n              isPreviewMode={isPreviewMode}\n              name={name}\n              onChange={field.onChange}\n              placeholder={placeholder}\n              textareaRef={textareaRef}\n              value={field.value}\n              ref={forwardedRef}\n            />\n            {!isExpandMode && !isMobile && <WysiwygFooter onToggleExpand={handleToggleExpand} />}\n            {isMobile && (\n              <Box position=\"absolute\" bottom={0} right={0} left={0} pointerEvents=\"none\">\n                <Flex justifyContent=\"flex-end\" padding={4}>\n                  <Box pointerEvents=\"auto\" display=\"inline-flex\">\n                    <WysiwygPreviewToggleButton\n                      isPreviewMode={isPreviewMode}\n                      onTogglePreviewMode={handleTogglePreviewMode}\n                    />\n                  </Box>\n                </Flex>\n              </Box>\n            )}\n          </EditorLayout>\n          <Field.Hint />\n          <Field.Error />\n        </Flex>\n        {mediaLibVisible && (\n          // @ts-expect-error â€“ TODO: fix this way of injecting because it's not really typeable without a registry.\n          <MediaLibraryDialog onClose={handleToggleMediaLib} onSelectAssets={handleSelectAssets} />\n        )}\n      </Field.Root>\n    );\n  }\n);\n\nconst MemoizedWysiwyg = React.memo(Wysiwyg);\n\nexport { MemoizedWysiwyg as Wysiwyg };\nexport type { WysiwygProps };\n"],"names":["Wysiwyg","React","forwardRef","hint","disabled","label","name","placeholder","required","labelAction","forwardedRef","field","useField","textareaRef","useRef","editorRef","isPreviewMode","setIsPreviewMode","useState","mediaLibVisible","setMediaLibVisible","isExpandMode","setIsExpandMode","isMobile","useIsMobile","components","useStrapiApp","state","MediaLibraryDialog","handleToggleMediaLib","prev","handleTogglePreviewMode","handleToggleExpand","handleSelectAssets","files","formattedFiles","map","f","alt","alternativeText","url","prefixFileUrlWithBackendUrl","mime","insertFile","_jsxs","Field","Root","error","Flex","direction","alignItems","gap","_jsx","Label","action","EditorLayout","previewContent","value","onCollapse","WysiwygNav","onToggleMediaLib","onTogglePreviewMode","undefined","Editor","onChange","ref","WysiwygFooter","onToggleExpand","Box","position","bottom","right","left","pointerEvents","justifyContent","padding","display","WysiwygPreviewToggleButton","Hint","Error","onClose","onSelectAssets","MemoizedWysiwyg","memo"],"mappings":"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"}