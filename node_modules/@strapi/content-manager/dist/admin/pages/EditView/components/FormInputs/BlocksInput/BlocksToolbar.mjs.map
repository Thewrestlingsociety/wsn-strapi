{"version":3,"file":"BlocksToolbar.mjs","sources":["../../../../../../../admin/src/pages/EditView/components/FormInputs/BlocksInput/BlocksToolbar.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport * as Toolbar from '@radix-ui/react-toolbar';\nimport { useIsMobile } from '@strapi/admin/strapi-admin';\nimport {\n  Flex,\n  Tooltip,\n  SingleSelect,\n  SingleSelectOption,\n  Box,\n  FlexComponent,\n  BoxComponent,\n  Menu,\n} from '@strapi/design-system';\nimport { Link, ArrowUp, ArrowDown } from '@strapi/icons';\nimport { MessageDescriptor, useIntl } from 'react-intl';\nimport { Editor, Transforms, Element as SlateElement, Node, type Ancestor } from 'slate';\nimport { ReactEditor } from 'slate-react';\nimport { css, styled } from 'styled-components';\n\nimport { getTranslation } from '../../../../../utils/translations';\nimport { EditorToolbarObserver, type ObservedComponent } from '../../EditorToolbarObserver';\n\nimport { insertLink } from './Blocks/Link';\nimport {\n  type BlocksStore,\n  type SelectorBlockKey,\n  isSelectorBlockKey,\n  useBlocksEditorContext,\n} from './BlocksEditor';\nimport { type Block, getEntries, getKeys } from './utils/types';\n\nconst ToolbarWrapper = styled<FlexComponent>(Flex)`\n  &[aria-disabled='true'] {\n    cursor: not-allowed;\n    background: ${({ theme }) => theme.colors.neutral150};\n  }\n`;\n\nconst ToolbarSeparator = styled(Toolbar.Separator)`\n  background: ${({ theme }) => theme.colors.neutral150};\n  width: 1px;\n  height: 2.4rem;\n  margin-left: ${({ theme }) => theme.spaces[1]};\n  margin-right: ${({ theme }) => theme.spaces[1]};\n\n  ${({ theme }) => theme.breakpoints.medium} {\n    margin-left: ${({ theme }) => theme.spaces[2]};\n    margin-right: ${({ theme }) => theme.spaces[2]};\n  }\n`;\n\nconst FlexButton = styled<FlexComponent<'button'>>(Flex)`\n  // Inherit the not-allowed cursor from ToolbarWrapper when disabled\n  &[aria-disabled] {\n    cursor: not-allowed;\n  }\n\n  &[aria-disabled='false'] {\n    cursor: pointer;\n\n    // Only apply hover styles if the button is enabled on desktop\n    ${({ theme }) => theme.breakpoints.medium} {\n      &:hover {\n        background: ${({ theme }) => theme.colors.primary100};\n      }\n    }\n  }\n`;\n\nconst SelectWrapper = styled<BoxComponent>(Box)`\n  // Styling changes to SingleSelect component don't work, so adding wrapper to target SingleSelect\n  div[role='combobox'] {\n    border: none;\n    cursor: pointer;\n    min-height: unset;\n    padding-top: ${({ theme }) => theme.spaces[2]};\n    padding-bottom: ${({ theme }) => theme.spaces[2]};\n    padding-left: ${({ theme }) => theme.spaces[4]};\n    padding-right: ${({ theme }) => theme.spaces[4]};\n    gap: ${({ theme }) => theme.spaces[2]};\n    \n    ${({ theme }) => theme.breakpoints.medium} {\n      padding-top: ${({ theme }) => theme.spaces[1]};\n      padding-bottom: ${({ theme }) => theme.spaces[1]};\n      gap: ${({ theme }) => theme.spaces[4]};\n    }\n\n    &[aria-disabled='false']:hover {\n      cursor: pointer;\n      background: ${({ theme }) => theme.colors.primary100};\n    }\n\n    &[aria-disabled] {\n      background: transparent;\n      cursor: inherit;\n\n      // Select text and icons should also have disabled color\n      span {\n        color: ${({ theme }) => theme.colors.neutral600};\n      }\n    }\n\n    & > span:first-child {\n     gap: ${({ theme }) => theme.spaces[0]};\n\n     ${({ theme }) => theme.breakpoints.medium} {\n      gap: ${({ theme }) => theme.spaces[3]};\n    }\n  }\n`;\n\n/**\n * Handles the modal component that may be returned by a block when converting it\n */\nfunction useConversionModal() {\n  const [modalElement, setModalComponent] = React.useState<React.JSX.Element | null>(null);\n\n  const handleConversionResult = (renderModal: void | (() => React.JSX.Element) | undefined) => {\n    // Not all blocks return a modal\n    if (renderModal) {\n      // Use cloneElement to apply a key because to create a new instance of the component\n      // Without the new key, the state is kept from previous times that option was picked\n      setModalComponent(React.cloneElement(renderModal(), { key: Date.now() }));\n    }\n  };\n\n  return { modalElement, handleConversionResult };\n}\n\ninterface ToolbarButtonProps {\n  icon: React.ComponentType<React.SVGProps<SVGSVGElement>>;\n  name: string;\n  label: MessageDescriptor;\n  isActive: boolean;\n  disabled: boolean;\n  handleClick: () => void;\n}\n\nconst ToolbarButton = ({\n  icon: Icon,\n  name,\n  label,\n  isActive,\n  disabled,\n  handleClick,\n}: ToolbarButtonProps) => {\n  const { editor } = useBlocksEditorContext('ToolbarButton');\n  const { formatMessage } = useIntl();\n  const labelMessage = formatMessage(label);\n\n  const enabledColor = isActive ? 'primary600' : 'neutral600';\n\n  return (\n    <Tooltip label={labelMessage}>\n      <Toolbar.ToggleItem\n        value={name}\n        data-state={isActive ? 'on' : 'off'}\n        onPointerDown={(e) => {\n          e.preventDefault();\n          handleClick();\n          ReactEditor.focus(editor);\n        }}\n        aria-disabled={disabled}\n        disabled={disabled}\n        aria-label={labelMessage}\n        asChild\n      >\n        <FlexButton\n          tag=\"button\"\n          background={isActive ? 'primary100' : ''}\n          alignItems=\"center\"\n          justifyContent=\"center\"\n          width={7}\n          height={7}\n          hasRadius\n          type=\"button\"\n        >\n          <Icon fill={disabled ? 'neutral300' : enabledColor} />\n        </FlexButton>\n      </Toolbar.ToggleItem>\n    </Tooltip>\n  );\n};\n\nconst BlocksDropdown = () => {\n  const { editor, blocks, disabled } = useBlocksEditorContext('BlocksDropdown');\n  const { formatMessage } = useIntl();\n  const { modalElement, handleConversionResult } = useConversionModal();\n  const isMobile = useIsMobile();\n\n  const blockKeysToInclude: SelectorBlockKey[] = getEntries(blocks).reduce<\n    ReturnType<typeof getEntries>\n  >((currentKeys, entry) => {\n    const [key, block] = entry;\n\n    return block.isInBlocksSelector ? [...currentKeys, key] : currentKeys;\n  }, []);\n\n  const [blockSelected, setBlockSelected] = React.useState<SelectorBlockKey>('paragraph');\n\n  const handleSelect = (optionKey: unknown) => {\n    if (!isSelectorBlockKey(optionKey)) {\n      return;\n    }\n\n    const editorIsEmpty =\n      editor.children.length === 1 && Editor.isEmpty(editor, editor.children[0]);\n\n    if (!editor.selection && !editorIsEmpty) {\n      // When there is no selection, create an empty block at the end of the editor\n      // so that it can be converted to the selected block\n      Transforms.insertNodes(\n        editor,\n        {\n          type: 'quote',\n          children: [{ type: 'text', text: '' }],\n        },\n        {\n          select: true,\n          // Since there's no selection, Slate will automatically insert the node at the end\n        }\n      );\n    } else if (!editor.selection && editorIsEmpty) {\n      // When there is no selection and the editor is empty,\n      // select the empty paragraph from Slate's initialValue so it gets converted\n      Transforms.select(editor, Editor.start(editor, [0, 0]));\n    }\n\n    // If selection is already a list block, toggle its format\n    const currentListEntry = Editor.above(editor, {\n      match: (node) => !Editor.isEditor(node) && node.type === 'list',\n    });\n\n    if (currentListEntry && ['list-ordered', 'list-unordered'].includes(optionKey)) {\n      const [currentList, currentListPath] = currentListEntry;\n      const format = optionKey === 'list-ordered' ? 'ordered' : 'unordered';\n\n      if (!Editor.isEditor(currentList) && isListNode(currentList)) {\n        // Format is different, toggle list format\n        if (currentList.format !== format) {\n          Transforms.setNodes(editor, { format }, { at: currentListPath });\n        }\n      }\n      return;\n    }\n\n    // Let the block handle the Slate conversion logic\n    const maybeRenderModal = blocks[optionKey].handleConvert?.(editor);\n    handleConversionResult(maybeRenderModal);\n\n    setBlockSelected(optionKey);\n\n    ReactEditor.focus(editor);\n  };\n\n  /**\n   * Prevent the select from focusing itself so ReactEditor.focus(editor) can focus the editor instead.\n   *\n   * The editor first loses focus to a blur event when clicking the select button. However,\n   * refocusing the editor is not enough since the select's default behavior is to refocus itself\n   * after an option is selected.\n   *\n   */\n  const preventSelectFocus = (e: Event) => e.preventDefault();\n\n  // Listen to the selection change and update the selected block in the dropdown\n  React.useEffect(() => {\n    if (editor.selection) {\n      let selectedNode: Ancestor;\n\n      // If selection anchor is a list-item, get its parent\n      const currentListEntry = Editor.above(editor, {\n        match: (node) => !Editor.isEditor(node) && node.type === 'list',\n        at: editor.selection.anchor,\n      });\n\n      if (currentListEntry) {\n        const [currentList] = currentListEntry;\n        selectedNode = currentList;\n      } else {\n        // Get the parent node of the anchor other than list-item\n        const [anchorNode] = Editor.parent(editor, editor.selection.anchor, {\n          edge: 'start',\n          depth: 2,\n        });\n\n        // @ts-expect-error slate's delete behaviour creates an exceptional type\n        if (anchorNode.type === 'list-item') {\n          // When the last node in the selection is a list item,\n          // slate's default delete operation leaves an empty list-item instead of converting it into a paragraph.\n          // Issue: https://github.com/ianstormtaylor/slate/issues/2500\n\n          Transforms.setNodes(editor, { type: 'paragraph' });\n          // @ts-expect-error convert explicitly type to paragraph\n          selectedNode = { ...anchorNode, type: 'paragraph' };\n        } else {\n          selectedNode = anchorNode;\n        }\n      }\n\n      // Find the block key that matches the anchor node\n      const anchorBlockKey = getKeys(blocks).find(\n        (blockKey) => !Editor.isEditor(selectedNode) && blocks[blockKey].matchNode(selectedNode)\n      );\n\n      // Change the value selected in the dropdown if it doesn't match the anchor block key\n      if (anchorBlockKey && anchorBlockKey !== blockSelected) {\n        setBlockSelected(anchorBlockKey as SelectorBlockKey);\n      }\n    }\n  }, [editor.selection, editor, blocks, blockSelected]);\n\n  const Icon = blocks[blockSelected].icon;\n\n  return (\n    <>\n      <SelectWrapper>\n        <SingleSelect\n          startIcon={<Icon />}\n          onChange={handleSelect}\n          customizeContent={() => (isMobile ? '' : formatMessage(blocks[blockSelected].label))}\n          value={blockSelected}\n          onCloseAutoFocus={preventSelectFocus}\n          aria-label={formatMessage({\n            id: 'components.Blocks.blocks.selectBlock',\n            defaultMessage: 'Select a block',\n          })}\n          disabled={disabled}\n        >\n          {blockKeysToInclude.map((key) => (\n            <BlockOption\n              key={key}\n              value={key}\n              label={blocks[key].label}\n              icon={blocks[key].icon}\n              blockSelected={blockSelected}\n            />\n          ))}\n        </SingleSelect>\n      </SelectWrapper>\n      {modalElement}\n    </>\n  );\n};\n\ninterface BlockOptionProps {\n  value: string;\n  icon: React.ComponentType<React.SVGProps<SVGElement>>;\n  label: MessageDescriptor;\n  blockSelected: string;\n}\n\nconst BlockOption = ({ value, icon: Icon, label, blockSelected }: BlockOptionProps) => {\n  const { formatMessage } = useIntl();\n\n  const isSelected = value === blockSelected;\n\n  return (\n    <SingleSelectOption\n      startIcon={<Icon fill={isSelected ? 'primary600' : 'neutral500'} />}\n      value={value}\n    >\n      {formatMessage(label)}\n    </SingleSelectOption>\n  );\n};\n\nconst isListNode = (node: unknown): node is Block<'list'> => {\n  return Node.isNode(node) && !Editor.isEditor(node) && node.type === 'list';\n};\n\ninterface ListButtonProps {\n  block: BlocksStore['list-ordered'] | BlocksStore['list-unordered'];\n  format: Block<'list'>['format'];\n  location?: 'toolbar' | 'menu';\n}\n\nconst ListButton = ({ block, format, location = 'toolbar' }: ListButtonProps) => {\n  const { formatMessage } = useIntl();\n  const { editor, disabled, blocks } = useBlocksEditorContext('ListButton');\n\n  const isListActive = () => {\n    if (!editor.selection) return false;\n\n    // Get the parent list at selection anchor node\n    const currentListEntry = Editor.above(editor, {\n      match: (node) => !Editor.isEditor(node) && node.type === 'list',\n      at: editor.selection.anchor,\n    });\n\n    if (currentListEntry) {\n      const [currentList] = currentListEntry;\n      if (!Editor.isEditor(currentList) && isListNode(currentList) && currentList.format === format)\n        return true;\n    }\n\n    return false;\n  };\n\n  /**\n   * @TODO: Currently, applying list while multiple blocks are selected is not supported.\n   * We should implement this feature in the future.\n   */\n  const isListDisabled = () => {\n    // Always disabled when the whole editor is disabled\n    if (disabled) {\n      return true;\n    }\n\n    // Always enabled when there's no selection\n    if (!editor.selection) {\n      return false;\n    }\n\n    // Get the block node closest to the anchor and focus\n    const anchorNodeEntry = Editor.above(editor, {\n      at: editor.selection.anchor,\n      match: (node) => !Editor.isEditor(node) && node.type !== 'text',\n    });\n    const focusNodeEntry = Editor.above(editor, {\n      at: editor.selection.focus,\n      match: (node) => !Editor.isEditor(node) && node.type !== 'text',\n    });\n\n    if (!anchorNodeEntry || !focusNodeEntry) {\n      return false;\n    }\n\n    // Disabled if the anchor and focus are not in the same block\n    return anchorNodeEntry[0] !== focusNodeEntry[0];\n  };\n\n  const toggleList = (format: Block<'list'>['format']) => {\n    let currentListEntry;\n    if (editor.selection) {\n      currentListEntry = Editor.above(editor, {\n        match: (node) => !Editor.isEditor(node) && node.type === 'list',\n      });\n    } else {\n      // If no selection, toggle last inserted node\n      const [_, lastNodePath] = Editor.last(editor, []);\n      currentListEntry = Editor.above(editor, {\n        match: (node) => !Editor.isEditor(node) && node.type === 'list',\n        at: lastNodePath,\n      });\n    }\n\n    if (!currentListEntry) {\n      // If selection is not a list then convert it to list\n      blocks[`list-${format}`].handleConvert!(editor);\n      return;\n    }\n\n    // If selection is already a list then toggle format\n    const [currentList, currentListPath] = currentListEntry;\n\n    if (!Editor.isEditor(currentList) && isListNode(currentList)) {\n      if (currentList.format !== format) {\n        // Format is different, toggle list format\n        Transforms.setNodes(editor, { format }, { at: currentListPath });\n      } else {\n        // Format is same, convert selected list-item to paragraph\n        blocks['paragraph'].handleConvert!(editor);\n      }\n    }\n  };\n\n  if (location === 'menu') {\n    const Icon = block.icon;\n\n    return (\n      <StyledMenuItem\n        startIcon={<Icon />}\n        onSelect={() => toggleList(format)}\n        isActive={isListActive()}\n        disabled={isListDisabled()}\n      >\n        {formatMessage(block.label)}\n      </StyledMenuItem>\n    );\n  }\n\n  return (\n    <ToolbarButton\n      icon={block.icon}\n      name={format}\n      label={block.label}\n      isActive={isListActive()}\n      disabled={isListDisabled()}\n      handleClick={() => toggleList(format)}\n    />\n  );\n};\n\nconst LinkButton = ({\n  disabled,\n  location = 'toolbar',\n}: {\n  disabled: boolean;\n  location?: 'toolbar' | 'menu';\n}) => {\n  const { editor } = useBlocksEditorContext('LinkButton');\n  const { formatMessage } = useIntl();\n\n  const isLinkActive = () => {\n    const { selection } = editor;\n\n    if (!selection) return false;\n\n    const [match] = Array.from(\n      Editor.nodes(editor, {\n        at: Editor.unhangRange(editor, selection),\n        match: (node) => SlateElement.isElement(node) && node.type === 'link',\n      })\n    );\n\n    return Boolean(match);\n  };\n\n  const isLinkDisabled = () => {\n    // Always disabled when the whole editor is disabled\n    if (disabled) {\n      return true;\n    }\n\n    // Always enabled when there's no selection\n    if (!editor.selection) {\n      return false;\n    }\n\n    // Get the block node closest to the anchor and focus\n    const anchorNodeEntry = Editor.above(editor, {\n      at: editor.selection.anchor,\n      match: (node) => !Editor.isEditor(node) && node.type !== 'text',\n    });\n    const focusNodeEntry = Editor.above(editor, {\n      at: editor.selection.focus,\n      match: (node) => !Editor.isEditor(node) && node.type !== 'text',\n    });\n\n    if (!anchorNodeEntry || !focusNodeEntry) {\n      return false;\n    }\n\n    // Disabled if the anchor and focus are not in the same block\n    return anchorNodeEntry[0] !== focusNodeEntry[0];\n  };\n\n  const addLink = () => {\n    editor.shouldSaveLinkPath = true;\n    // We insert an empty anchor, so we split the DOM to have a element we can use as reference for the popover\n    insertLink(editor, { url: '' });\n  };\n\n  const label = {\n    id: 'components.Blocks.link',\n    defaultMessage: 'Link',\n  } as MessageDescriptor;\n\n  if (location === 'menu') {\n    return (\n      <StyledMenuItem\n        startIcon={<Link />}\n        onSelect={addLink}\n        isActive={isLinkActive()}\n        disabled={isLinkDisabled()}\n      >\n        {formatMessage(label)}\n      </StyledMenuItem>\n    );\n  }\n\n  return (\n    <ToolbarButton\n      icon={Link}\n      name=\"link\"\n      label={label}\n      isActive={isLinkActive()}\n      handleClick={addLink}\n      disabled={isLinkDisabled()}\n    />\n  );\n};\n\nconst StyledMenuItem = styled(Menu.Item)<{ isActive: boolean }>`\n  ${(props) =>\n    props.isActive &&\n    css`\n      color: ${({ theme }) => theme.colors.primary600};\n      font-weight: 600;\n    `}\n\n  svg {\n    fill: ${({ theme, isActive }) =>\n      isActive ? theme.colors.primary600 : theme.colors.neutral500};\n  }\n`;\n\nconst ReorderToolbarButtons = () => {\n  const { editor, disabled, blocks, name, setLiveText } =\n    useBlocksEditorContext('ReorderToolbarButtons');\n  const { formatMessage } = useIntl();\n\n  const selection = editor.selection;\n  const totalBlocks = editor.children.length;\n\n  const anchorIndex = selection ? selection.anchor.path[0] : null;\n  const focusIndex = selection ? selection.focus.path[0] : null;\n  const isSingleBlockSelection =\n    anchorIndex !== null && focusIndex !== null && anchorIndex === focusIndex;\n\n  const selectedTopLevelNode =\n    isSingleBlockSelection && anchorIndex !== null ? editor.children[anchorIndex] : null;\n  const selectedBlock =\n    selectedTopLevelNode &&\n    Object.values(blocks).find((block) => block.matchNode(selectedTopLevelNode));\n\n  const isSelectedBlockDraggable =\n    selectedTopLevelNode && selectedBlock\n      ? (selectedBlock.isDraggable?.(selectedTopLevelNode) ?? true)\n      : false;\n\n  const canMoveUp =\n    !disabled &&\n    isSingleBlockSelection &&\n    isSelectedBlockDraggable &&\n    anchorIndex !== null &&\n    anchorIndex > 0;\n  const canMoveDown =\n    !disabled &&\n    isSingleBlockSelection &&\n    isSelectedBlockDraggable &&\n    anchorIndex !== null &&\n    anchorIndex < totalBlocks - 1;\n\n  const moveBlock = (direction: 'up' | 'down') => {\n    if (!selection || anchorIndex === null) return;\n\n    const currentIndex = [anchorIndex];\n    const newIndex = [direction === 'up' ? anchorIndex - 1 : anchorIndex + 1];\n\n    Transforms.moveNodes(editor, {\n      at: currentIndex,\n      to: newIndex,\n    });\n\n    // Keep the moved block focused so disabled states update immediately.\n    Transforms.select(editor, Editor.start(editor, newIndex));\n    ReactEditor.focus(editor);\n\n    setLiveText(\n      formatMessage(\n        {\n          id: getTranslation('components.Blocks.dnd.reorder'),\n          defaultMessage: '{item}, moved. New position in the editor: {position}.',\n        },\n        {\n          item: `${name}.${currentIndex[0] + 1}`,\n          position: `${newIndex[0] + 1} of ${editor.children.length}`,\n        }\n      )\n    );\n  };\n\n  return (\n    <Flex direction=\"row\" gap={1}>\n      <Tooltip\n        label={formatMessage({\n          id: getTranslation('components.DynamicZone.move-up'),\n          defaultMessage: 'Move up',\n        })}\n      >\n        <Toolbar.Button\n          onPointerDown={(e) => {\n            e.preventDefault();\n            if (canMoveUp) moveBlock('up');\n          }}\n          aria-disabled={!canMoveUp}\n          disabled={!canMoveUp}\n          aria-label={formatMessage({\n            id: getTranslation('components.DynamicZone.move-up'),\n            defaultMessage: 'Move up',\n          })}\n          asChild\n        >\n          <FlexButton\n            tag=\"button\"\n            alignItems=\"center\"\n            justifyContent=\"center\"\n            width={7}\n            height={7}\n            hasRadius\n            type=\"button\"\n          >\n            <ArrowUp fill={!canMoveUp ? 'neutral300' : 'neutral600'} />\n          </FlexButton>\n        </Toolbar.Button>\n      </Tooltip>\n\n      <Tooltip\n        label={formatMessage({\n          id: getTranslation('components.DynamicZone.move-down'),\n          defaultMessage: 'Move down',\n        })}\n      >\n        <Toolbar.Button\n          onPointerDown={(e) => {\n            e.preventDefault();\n            if (canMoveDown) moveBlock('down');\n          }}\n          aria-disabled={!canMoveDown}\n          disabled={!canMoveDown}\n          aria-label={formatMessage({\n            id: getTranslation('components.DynamicZone.move-down'),\n            defaultMessage: 'Move down',\n          })}\n          asChild\n        >\n          <FlexButton\n            tag=\"button\"\n            alignItems=\"center\"\n            justifyContent=\"center\"\n            width={7}\n            height={7}\n            hasRadius\n            type=\"button\"\n          >\n            <ArrowDown fill={!canMoveDown ? 'neutral300' : 'neutral600'} />\n          </FlexButton>\n        </Toolbar.Button>\n      </Tooltip>\n    </Flex>\n  );\n};\n\nconst BlocksToolbar = () => {\n  const { editor, blocks, modifiers, disabled } = useBlocksEditorContext('BlocksToolbar');\n  const { formatMessage } = useIntl();\n  const isMobile = useIsMobile();\n\n  /**\n   * The modifier buttons are disabled when an image is selected.\n   */\n  const checkButtonDisabled = () => {\n    // Always disabled when the whole editor is disabled\n    if (disabled) {\n      return true;\n    }\n\n    if (!editor.selection) {\n      return false;\n    }\n\n    const selectedNode = editor.children[editor.selection.anchor.path[0]];\n    if (!selectedNode) return true;\n\n    if (['image', 'code'].includes(selectedNode.type)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const isButtonDisabled = checkButtonDisabled();\n\n  /**\n   * Observed components are ones that may or may not be visible in the toolbar, depending on the\n   * available space. They provide two render props:\n   * - renderInToolbar: for when we try to render the component in the toolbar (may be hidden)\n   * - renderInMenu: for when the component didn't fit in the toolbar and is relegated\n   *   to the \"more\" menu\n   */\n  const observedComponents: ObservedComponent[] = [\n    ...Object.entries(modifiers).map(([name, modifier]) => {\n      const Icon = modifier.icon;\n      const isActive = modifier.checkIsActive(editor);\n      const handleSelect = () => modifier.handleToggle(editor);\n\n      return {\n        toolbar: (\n          <ToolbarButton\n            key={name}\n            name={name}\n            icon={modifier.icon}\n            label={modifier.label}\n            isActive={modifier.checkIsActive(editor)}\n            handleClick={handleSelect}\n            disabled={isButtonDisabled}\n          />\n        ),\n        menu: (\n          <StyledMenuItem startIcon={<Icon />} onSelect={handleSelect} isActive={isActive}>\n            {formatMessage(modifier.label)}\n          </StyledMenuItem>\n        ),\n        key: `modifier.${name}`,\n      };\n    }),\n    {\n      toolbar: <LinkButton disabled={isButtonDisabled} location=\"toolbar\" />,\n      menu: <LinkButton disabled={isButtonDisabled} location=\"menu\" />,\n      key: 'block.link',\n    },\n    {\n      // List buttons can only be rendered together when in the toolbar\n      toolbar: (\n        <Flex direction=\"row\">\n          <ToolbarSeparator style={{ marginLeft: '0.4rem' }} />\n          <Toolbar.ToggleGroup type=\"single\" asChild>\n            <Flex gap={1}>\n              <ListButton block={blocks['list-unordered']} format=\"unordered\" location=\"toolbar\" />\n              <ListButton block={blocks['list-ordered']} format=\"ordered\" location=\"toolbar\" />\n            </Flex>\n          </Toolbar.ToggleGroup>\n        </Flex>\n      ),\n      menu: (\n        <>\n          <Menu.Separator />\n          <ListButton block={blocks['list-unordered']} format=\"unordered\" location=\"menu\" />\n          <ListButton block={blocks['list-ordered']} format=\"ordered\" location=\"menu\" />\n        </>\n      ),\n      key: 'block.list',\n    },\n  ];\n\n  return (\n    <Toolbar.Root aria-disabled={disabled} asChild>\n      <ToolbarWrapper padding={{ initial: 1, medium: 2 }} width=\"100%\">\n        <BlocksDropdown />\n        {isMobile && (\n          <>\n            <ToolbarSeparator />\n            <ReorderToolbarButtons />\n          </>\n        )}\n        <ToolbarSeparator />\n        <Toolbar.ToggleGroup type=\"multiple\" asChild>\n          <Flex direction=\"row\" gap={1} grow={1} overflow=\"hidden\">\n            <EditorToolbarObserver observedComponents={observedComponents} />\n          </Flex>\n        </Toolbar.ToggleGroup>\n      </ToolbarWrapper>\n    </Toolbar.Root>\n  );\n};\n\nexport { BlocksToolbar, useConversionModal };\n"],"names":["ToolbarWrapper","styled","Flex","theme","colors","neutral150","ToolbarSeparator","Toolbar","Separator","spaces","breakpoints","medium","FlexButton","primary100","SelectWrapper","Box","neutral600","useConversionModal","modalElement","setModalComponent","React","useState","handleConversionResult","renderModal","cloneElement","key","Date","now","ToolbarButton","icon","Icon","name","label","isActive","disabled","handleClick","editor","useBlocksEditorContext","formatMessage","useIntl","labelMessage","enabledColor","_jsx","Tooltip","ToggleItem","value","data-state","onPointerDown","e","preventDefault","ReactEditor","focus","aria-disabled","aria-label","asChild","tag","background","alignItems","justifyContent","width","height","hasRadius","type","fill","BlocksDropdown","blocks","isMobile","useIsMobile","blockKeysToInclude","getEntries","reduce","currentKeys","entry","block","isInBlocksSelector","blockSelected","setBlockSelected","handleSelect","optionKey","isSelectorBlockKey","editorIsEmpty","children","length","Editor","isEmpty","selection","Transforms","insertNodes","text","select","start","currentListEntry","above","match","node","isEditor","includes","currentList","currentListPath","format","isListNode","setNodes","at","maybeRenderModal","handleConvert","preventSelectFocus","useEffect","selectedNode","anchor","anchorNode","parent","edge","depth","anchorBlockKey","getKeys","find","blockKey","matchNode","_jsxs","_Fragment","SingleSelect","startIcon","onChange","customizeContent","onCloseAutoFocus","id","defaultMessage","map","BlockOption","isSelected","SingleSelectOption","Node","isNode","ListButton","location","isListActive","isListDisabled","anchorNodeEntry","focusNodeEntry","toggleList","_","lastNodePath","last","StyledMenuItem","onSelect","LinkButton","isLinkActive","Array","from","nodes","unhangRange","SlateElement","isElement","Boolean","isLinkDisabled","addLink","shouldSaveLinkPath","insertLink","url","Link","Menu","Item","props","css","primary600","neutral500","ReorderToolbarButtons","setLiveText","totalBlocks","anchorIndex","path","focusIndex","isSingleBlockSelection","selectedTopLevelNode","selectedBlock","Object","values","isSelectedBlockDraggable","isDraggable","canMoveUp","canMoveDown","moveBlock","direction","currentIndex","newIndex","moveNodes","to","getTranslation","item","position","gap","Button","ArrowUp","ArrowDown","BlocksToolbar","modifiers","checkButtonDisabled","isButtonDisabled","observedComponents","entries","modifier","checkIsActive","handleToggle","toolbar","menu","style","marginLeft","ToggleGroup","Root","padding","initial","grow","overflow","EditorToolbarObserver"],"mappings":"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"}