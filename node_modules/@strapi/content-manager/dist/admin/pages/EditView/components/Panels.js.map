{"version":3,"file":"Panels.js","sources":["../../../../../admin/src/pages/EditView/components/Panels.tsx"],"sourcesContent":["import * as React from 'react';\n\nimport {\n  useQueryParams,\n  useStrapiApp,\n  DescriptionComponentRenderer,\n  useIsDesktop,\n  createContext,\n} from '@strapi/admin/strapi-admin';\nimport { Flex, Typography } from '@strapi/design-system';\nimport { useIntl } from 'react-intl';\nimport { useMatch } from 'react-router-dom';\n\nimport { InjectionZone } from '../../../components/InjectionZone';\nimport { useDoc } from '../../../hooks/useDocument';\nimport { CLONE_PATH } from '../../../router';\n\nimport { DocumentActions } from './DocumentActions';\n\nimport type {\n  ContentManagerPlugin,\n  DocumentActionProps,\n  PanelComponent,\n  PanelComponentProps,\n} from '../../../content-manager';\n\ninterface PanelDescription {\n  title: string;\n  content: React.ReactNode;\n}\ninterface PanelsItemsProps {\n  panels: (PanelDescription & { id: string })[];\n  setVisiblePanels:\n    | React.Dispatch<React.SetStateAction<(PanelDescription & { id: string })[]>>\n    | null\n    | undefined;\n  visiblePanelsLength: number | undefined;\n}\n\nconst PanelsItems = ({ panels, setVisiblePanels, visiblePanelsLength }: PanelsItemsProps) => {\n  React.useEffect(() => {\n    if (setVisiblePanels && visiblePanelsLength !== panels.length) {\n      setVisiblePanels(panels);\n    }\n  }, [panels, panels.length, setVisiblePanels, visiblePanelsLength]);\n\n  return (\n    <>\n      {panels.map(({ content, id, ...description }) => (\n        <Panel key={id} {...description}>\n          {content}\n        </Panel>\n      ))}\n    </>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Panels\n * -----------------------------------------------------------------------------------------------*/\n\nconst Panels = ({ withActions = true }: { withActions?: boolean }) => {\n  const isCloning = useMatch(CLONE_PATH) !== null;\n  const [\n    {\n      query: { status },\n    },\n  ] = useQueryParams<{ status: 'draft' | 'published' }>({\n    status: 'draft',\n  });\n  const { model, id, document, meta, collectionType } = useDoc();\n  const plugins = useStrapiApp('Panels', (state) => state.plugins);\n  // Optional context consumer\n  const setVisiblePanels = usePanelsContext('Panels', (s) => s.setVisiblePanels, false);\n  const visiblePanels = usePanelsContext('Panels', (s) => s.visiblePanels, false);\n\n  const allPanels = (\n    plugins['content-manager'].apis as ContentManagerPlugin['config']['apis']\n  ).getEditViewSidePanels();\n  const filteredPanels = allPanels.filter((panel) => (panel as PanelComponent).type !== 'actions');\n  const panelsToDisplay = withActions ? allPanels : filteredPanels;\n\n  const props = {\n    activeTab: status,\n    model,\n    documentId: id,\n    document: isCloning ? undefined : document,\n    meta: isCloning ? undefined : meta,\n    collectionType,\n  } satisfies PanelComponentProps;\n\n  return (\n    <Flex direction=\"column\" alignItems=\"stretch\" gap={2}>\n      <DescriptionComponentRenderer props={props} descriptions={panelsToDisplay}>\n        {(panels) => (\n          <PanelsItems\n            panels={panels}\n            setVisiblePanels={setVisiblePanels}\n            visiblePanelsLength={visiblePanels?.length}\n          />\n        )}\n      </DescriptionComponentRenderer>\n    </Flex>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Default Action Panels (CE)\n * -----------------------------------------------------------------------------------------------*/\n\nconst ActionsPanel: PanelComponent = () => {\n  const { formatMessage } = useIntl();\n\n  return {\n    title: formatMessage({\n      id: 'content-manager.containers.edit.panels.default.title',\n      defaultMessage: 'Entry',\n    }),\n    content: <ActionsPanelContent />,\n  };\n};\n\nActionsPanel.type = 'actions';\n\nconst ActionsPanelContent = () => {\n  const isCloning = useMatch(CLONE_PATH) !== null;\n  const [\n    {\n      query: { status = 'draft' },\n    },\n  ] = useQueryParams<{ status: 'draft' | 'published' }>();\n  const { model, id, document, meta, collectionType } = useDoc();\n  const plugins = useStrapiApp('ActionsPanel', (state) => state.plugins);\n\n  const props = {\n    activeTab: status,\n    model,\n    documentId: id,\n    document: isCloning ? undefined : document,\n    meta: isCloning ? undefined : meta,\n    collectionType,\n  } satisfies DocumentActionProps;\n\n  return (\n    <Flex direction=\"column\" gap={2} width=\"100%\">\n      <DescriptionComponentRenderer\n        props={props}\n        descriptions={(\n          plugins['content-manager'].apis as ContentManagerPlugin['config']['apis']\n        ).getDocumentActions('panel')}\n      >\n        {(actions) => <DocumentActions actions={actions} />}\n      </DescriptionComponentRenderer>\n      <InjectionZone area=\"editView.right-links\" slug={model} />\n    </Flex>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Panel\n * -----------------------------------------------------------------------------------------------*/\n\ninterface PanelProps extends Pick<PanelDescription, 'title'> {\n  children: React.ReactNode;\n}\n\nconst Panel = React.forwardRef<any, PanelProps>(({ children, title }, ref) => {\n  const isDesktop = useIsDesktop();\n\n  return (\n    <Flex\n      ref={ref}\n      tag=\"aside\"\n      aria-labelledby=\"additional-information\"\n      background={{ initial: 'transparent', large: 'neutral0' }}\n      borderColor={{ initial: 'transparent', large: 'neutral150' }}\n      hasRadius={isDesktop}\n      padding={{ initial: 0, large: 4 }}\n      shadow={{ initial: 'none', large: 'tableShadow' }}\n      gap={{ initial: 4, large: 3 }}\n      direction=\"column\"\n      justifyContent=\"stretch\"\n      alignItems=\"flex-start\"\n    >\n      <Typography tag=\"h2\" variant=\"sigma\" textTransform=\"uppercase\" textColor=\"neutral600\">\n        {title}\n      </Typography>\n      {children}\n    </Flex>\n  );\n});\n\n/* -------------------------------------------------------------------------------------------------\n * PanelsContext\n * -----------------------------------------------------------------------------------------------*/\n\nconst [PanelsProviderImpl, usePanelsContext] = createContext<{\n  visiblePanels: (PanelDescription & { id: string })[];\n  setVisiblePanels: React.Dispatch<React.SetStateAction<(PanelDescription & { id: string })[]>>;\n}>('PanelsContext');\n\nconst PanelsProvider = ({ children }: React.PropsWithChildren) => {\n  const [visiblePanels, setVisiblePanels] = React.useState<(PanelDescription & { id: string })[]>(\n    []\n  );\n\n  return (\n    <PanelsProviderImpl visiblePanels={visiblePanels} setVisiblePanels={setVisiblePanels}>\n      {children}\n    </PanelsProviderImpl>\n  );\n};\n\nexport { Panels, ActionsPanel, ActionsPanelContent, PanelsProvider, usePanelsContext };\nexport type { PanelDescription };\n"],"names":["PanelsItems","panels","setVisiblePanels","visiblePanelsLength","React","useEffect","length","_jsx","_Fragment","map","content","id","description","Panel","Panels","withActions","isCloning","useMatch","CLONE_PATH","query","status","useQueryParams","model","document","meta","collectionType","useDoc","plugins","useStrapiApp","state","usePanelsContext","s","visiblePanels","allPanels","apis","getEditViewSidePanels","filteredPanels","filter","panel","type","panelsToDisplay","props","activeTab","documentId","undefined","Flex","direction","alignItems","gap","DescriptionComponentRenderer","descriptions","ActionsPanel","formatMessage","useIntl","title","defaultMessage","ActionsPanelContent","_jsxs","width","getDocumentActions","actions","DocumentActions","InjectionZone","area","slug","forwardRef","children","ref","isDesktop","useIsDesktop","tag","aria-labelledby","background","initial","large","borderColor","hasRadius","padding","shadow","justifyContent","Typography","variant","textTransform","textColor","PanelsProviderImpl","createContext","PanelsProvider","useState"],"mappings":"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"}