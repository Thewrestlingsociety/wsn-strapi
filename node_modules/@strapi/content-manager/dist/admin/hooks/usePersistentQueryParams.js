'use strict';

var React = require('react');
var strapiAdmin = require('@strapi/admin/strapi-admin');
var get = require('lodash/get');
var set = require('lodash/set');
var reactRouterDom = require('react-router-dom');

const filterObjectKeys = (obj, keys)=>{
    const result = {};
    for (const path of keys){
        const value = get(obj, path);
        if (value !== undefined) {
            set(result, path, value);
        }
    }
    return result;
};
const usePersistentPartialQueryParams = (keyPrefix, keysToPersist, pathnameInKey = true)=>{
    const { pathname } = reactRouterDom.useLocation();
    const [{ query }, setQuery] = strapiAdmin.useQueryParams();
    const localStorageKey = `${keyPrefix}${pathnameInKey ? pathname : ''}`;
    // load query params from local storge
    React.useEffect(()=>{
        const savedQueryParams = window.localStorage.getItem(localStorageKey);
        if (!savedQueryParams) return;
        let parsedSavedParams;
        try {
            parsedSavedParams = JSON.parse(savedQueryParams);
        } catch  {
            return;
        }
        if (Object.keys(parsedSavedParams).length === 0) return;
        const filteredQuery = filterObjectKeys(parsedSavedParams, keysToPersist);
        setQuery({
            ...filteredQuery,
            ...query
        }, 'push', true);
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [
        localStorageKey
    ]);
    // update local storage
    React.useEffect(()=>{
        const paramsToPersist = filterObjectKeys(query, keysToPersist);
        if (Object.keys(paramsToPersist).length === 0) return;
        window.localStorage.setItem(localStorageKey, JSON.stringify(paramsToPersist));
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [
        query,
        keysToPersist
    ]);
};

exports.usePersistentPartialQueryParams = usePersistentPartialQueryParams;
//# sourceMappingURL=usePersistentQueryParams.js.map
