{"version":3,"file":"usePersistentQueryParams.js","sources":["../../../admin/src/hooks/usePersistentQueryParams.ts"],"sourcesContent":["import { useEffect } from 'react';\n\nimport { useQueryParams } from '@strapi/admin/strapi-admin';\nimport get from 'lodash/get';\nimport set from 'lodash/set';\nimport { useLocation } from 'react-router-dom';\n\ntype PropertyPath = Parameters<typeof get>[1];\n\nconst filterObjectKeys = (obj: object, keys: PropertyPath[]) => {\n  const result: Record<string, unknown> = {};\n\n  for (const path of keys) {\n    const value = get(obj, path);\n\n    if (value !== undefined) {\n      set(result, path, value);\n    }\n  }\n\n  return result;\n};\n\nexport const usePersistentPartialQueryParams = (\n  keyPrefix: string,\n  keysToPersist: PropertyPath[],\n  pathnameInKey = true\n) => {\n  const { pathname } = useLocation();\n  const [{ query }, setQuery] = useQueryParams();\n  const localStorageKey = `${keyPrefix}${pathnameInKey ? pathname : ''}`;\n\n  // load query params from local storge\n  useEffect(() => {\n    const savedQueryParams = window.localStorage.getItem(localStorageKey);\n    if (!savedQueryParams) return;\n\n    let parsedSavedParams: Record<string, unknown>;\n    try {\n      parsedSavedParams = JSON.parse(savedQueryParams);\n    } catch {\n      return;\n    }\n    if (Object.keys(parsedSavedParams).length === 0) return;\n\n    const filteredQuery = filterObjectKeys(parsedSavedParams, keysToPersist);\n    setQuery({ ...filteredQuery, ...query }, 'push', true);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [localStorageKey]);\n\n  // update local storage\n  useEffect(() => {\n    const paramsToPersist = filterObjectKeys(query, keysToPersist);\n    if (Object.keys(paramsToPersist).length === 0) return;\n    window.localStorage.setItem(localStorageKey, JSON.stringify(paramsToPersist));\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [query, keysToPersist]);\n};\n"],"names":["filterObjectKeys","obj","keys","result","path","value","get","undefined","set","usePersistentPartialQueryParams","keyPrefix","keysToPersist","pathnameInKey","pathname","useLocation","query","setQuery","useQueryParams","localStorageKey","useEffect","savedQueryParams","window","localStorage","getItem","parsedSavedParams","JSON","parse","Object","length","filteredQuery","paramsToPersist","setItem","stringify"],"mappings":";;;;;;;;AASA,MAAMA,gBAAAA,GAAmB,CAACC,GAAaC,EAAAA,IAAAA,GAAAA;AACrC,IAAA,MAAMC,SAAkC,EAAC;IAEzC,KAAK,MAAMC,QAAQF,IAAM,CAAA;QACvB,MAAMG,KAAAA,GAAQC,IAAIL,GAAKG,EAAAA,IAAAA,CAAAA;AAEvB,QAAA,IAAIC,UAAUE,SAAW,EAAA;AACvBC,YAAAA,GAAAA,CAAIL,QAAQC,IAAMC,EAAAA,KAAAA,CAAAA;AACpB;AACF;IAEA,OAAOF,MAAAA;AACT,CAAA;MAEaM,+BAAkC,GAAA,CAC7CC,SACAC,EAAAA,aAAAA,EACAC,gBAAgB,IAAI,GAAA;IAEpB,MAAM,EAAEC,QAAQ,EAAE,GAAGC,0BAAAA,EAAAA;AACrB,IAAA,MAAM,CAAC,EAAEC,KAAK,EAAE,EAAEC,SAAS,GAAGC,0BAAAA,EAAAA;AAC9B,IAAA,MAAMC,eAAkB,GAAA,CAAA,EAAGR,SAAYE,CAAAA,EAAAA,aAAAA,GAAgBC,WAAW,EAAI,CAAA,CAAA;;IAGtEM,eAAU,CAAA,IAAA;AACR,QAAA,MAAMC,gBAAmBC,GAAAA,MAAAA,CAAOC,YAAY,CAACC,OAAO,CAACL,eAAAA,CAAAA;AACrD,QAAA,IAAI,CAACE,gBAAkB,EAAA;QAEvB,IAAII,iBAAAA;QACJ,IAAI;YACFA,iBAAoBC,GAAAA,IAAAA,CAAKC,KAAK,CAACN,gBAAAA,CAAAA;AACjC,SAAA,CAAE,OAAM;AACN,YAAA;AACF;AACA,QAAA,IAAIO,OAAOzB,IAAI,CAACsB,iBAAmBI,CAAAA,CAAAA,MAAM,KAAK,CAAG,EAAA;QAEjD,MAAMC,aAAAA,GAAgB7B,iBAAiBwB,iBAAmBb,EAAAA,aAAAA,CAAAA;QAC1DK,QAAS,CAAA;AAAE,YAAA,GAAGa,aAAa;AAAE,YAAA,GAAGd;AAAM,SAAA,EAAG,MAAQ,EAAA,IAAA,CAAA;;KAEhD,EAAA;AAACG,QAAAA;AAAgB,KAAA,CAAA;;IAGpBC,eAAU,CAAA,IAAA;QACR,MAAMW,eAAAA,GAAkB9B,iBAAiBe,KAAOJ,EAAAA,aAAAA,CAAAA;AAChD,QAAA,IAAIgB,OAAOzB,IAAI,CAAC4B,eAAiBF,CAAAA,CAAAA,MAAM,KAAK,CAAG,EAAA;AAC/CP,QAAAA,MAAAA,CAAOC,YAAY,CAACS,OAAO,CAACb,eAAiBO,EAAAA,IAAAA,CAAKO,SAAS,CAACF,eAAAA,CAAAA,CAAAA;;KAE3D,EAAA;AAACf,QAAAA,KAAAA;AAAOJ,QAAAA;AAAc,KAAA,CAAA;AAC3B;;;;"}