{"version":3,"file":"UploadDropZoneContext.js","sources":["../../../../../../../admin/src/future/pages/Assets/components/DropZone/UploadDropZoneContext.tsx"],"sourcesContent":["import {\n  createContext,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n  type DragEvent,\n  type ReactNode,\n} from 'react';\n\nimport { Box } from '@strapi/design-system';\nimport { styled } from 'styled-components';\n\n/* -------------------------------------------------------------------------------------------------\n * Types\n * -----------------------------------------------------------------------------------------------*/\n\ntype DropHandler = (files: File[]) => void | Promise<void>;\n\ninterface UploadDropZoneContextValue {\n  isDragging: boolean;\n}\n\n/* -------------------------------------------------------------------------------------------------\n * Context\n * -----------------------------------------------------------------------------------------------*/\n\nconst UploadDropZoneContext = createContext<UploadDropZoneContextValue | null>(null);\n\n/* -------------------------------------------------------------------------------------------------\n * Components\n * -----------------------------------------------------------------------------------------------*/\n\nconst DropZoneWrapper = styled(Box)`\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  min-height: 100%;\n`;\n\n/* -------------------------------------------------------------------------------------------------\n * Provider\n * -----------------------------------------------------------------------------------------------*/\n\ninterface UploadDropZoneProps {\n  children: ReactNode;\n  onDrop?: DropHandler;\n}\n\nexport const UploadDropZoneProvider = ({ children, onDrop }: UploadDropZoneProps) => {\n  const [isDragging, setIsDragging] = useState(false);\n  const dragCounterRef = useRef(0);\n\n  const contextValue: UploadDropZoneContextValue = {\n    isDragging,\n  };\n\n  useEffect(() => {\n    const handleDragEnd = () => {\n      setIsDragging(false);\n      dragCounterRef.current = 0;\n    };\n\n    // Handle drag leaving the entire document/window\n    const handleDocumentDragLeave = (e: globalThis.DragEvent) => {\n      // When relatedTarget is null, we're leaving the document entirely\n      if (!e.relatedTarget) {\n        setIsDragging(false);\n        dragCounterRef.current = 0;\n      }\n    };\n\n    document.addEventListener('dragend', handleDragEnd);\n    document.addEventListener('dragleave', handleDocumentDragLeave);\n\n    return () => {\n      document.removeEventListener('dragend', handleDragEnd);\n      document.removeEventListener('dragleave', handleDocumentDragLeave);\n    };\n  }, []);\n\n  const handleDragEnter = useCallback((e: DragEvent<HTMLElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    dragCounterRef.current += 1;\n\n    if (e.dataTransfer.types.includes('Files')) {\n      setIsDragging(true);\n    }\n  }, []);\n\n  const handleDragLeave = useCallback((e: DragEvent<HTMLElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n\n    dragCounterRef.current -= 1;\n\n    // Only set dragging to false if we've left the dropzone completely\n    // (counter reaches 0 or negative)\n    if (dragCounterRef.current <= 0) {\n      setIsDragging(false);\n      dragCounterRef.current = 0;\n    }\n  }, []);\n\n  const handleDragOver = useCallback((e: DragEvent<HTMLElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    e.dataTransfer.dropEffect = 'copy';\n  }, []);\n\n  const handleDrop = useCallback(\n    (e: DragEvent<HTMLElement>) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setIsDragging(false);\n      dragCounterRef.current = 0;\n\n      const { files } = e.dataTransfer;\n      if (files?.length && onDrop) {\n        onDrop(Array.from(files));\n      }\n    },\n    [onDrop]\n  );\n\n  return (\n    <UploadDropZoneContext.Provider value={contextValue}>\n      <DropZoneWrapper\n        data-testid=\"assets-dropzone\"\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n      >\n        {children}\n      </DropZoneWrapper>\n    </UploadDropZoneContext.Provider>\n  );\n};\n\n/* -------------------------------------------------------------------------------------------------\n * Hook\n * -----------------------------------------------------------------------------------------------*/\n\nexport const useUploadDropZone = () => {\n  const context = useContext(UploadDropZoneContext);\n\n  if (!context) {\n    throw new Error('useUploadDropZone must be used within UploadDropZone');\n  }\n\n  return {\n    isDragging: context.isDragging,\n  };\n};\n"],"names":["UploadDropZoneContext","createContext","DropZoneWrapper","styled","Box","UploadDropZoneProvider","children","onDrop","isDragging","setIsDragging","useState","dragCounterRef","useRef","contextValue","useEffect","handleDragEnd","current","handleDocumentDragLeave","e","relatedTarget","document","addEventListener","removeEventListener","handleDragEnter","useCallback","preventDefault","stopPropagation","dataTransfer","types","includes","handleDragLeave","handleDragOver","dropEffect","handleDrop","files","length","Array","from","_jsx","Provider","value","data-testid","onDragEnter","onDragLeave","onDragOver","useUploadDropZone","context","useContext","Error"],"mappings":"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"}