{"version":3,"file":"EditAssetContent.js","sources":["../../../../admin/src/components/EditAssetDialog/EditAssetContent.tsx"],"sourcesContent":["/**\n *\n * EditAssetDialog\n *\n */\nimport * as React from 'react';\n\nimport {\n  Button,\n  Field,\n  Flex,\n  Grid,\n  Loader,\n  Modal,\n  TextInput,\n  VisuallyHidden,\n} from '@strapi/design-system';\nimport { Form, Formik } from 'formik';\nimport isEqual from 'lodash/isEqual';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\nimport * as yup from 'yup';\n\nimport { useEditAsset } from '../../hooks/useEditAsset';\nimport { useFolderStructure } from '../../hooks/useFolderStructure';\nimport { useTracking } from '../../hooks/useTracking';\nimport { findRecursiveFolderByValue, getTrad, getFileExtension, formatBytes } from '../../utils';\nimport { ContextInfo } from '../ContextInfo/ContextInfo';\nimport { SelectTree } from '../SelectTree/SelectTree';\n\nimport { DialogHeader } from './DialogHeader';\nimport { PreviewBox } from './PreviewBox/PreviewBox';\nimport { ReplaceMediaButton } from './ReplaceMediaButton';\n\nimport type {\n  File as FileDefinition,\n  RawFile,\n  FocalPoint,\n} from '../../../../shared/contracts/files';\n\nconst LoadingBody = styled(Flex)`\n  /* 80px are coming from the Tabs component that is not included in the ModalBody */\n  min-height: ${() => `calc(60dvh + 8rem)`};\n`;\n\nconst focalPointSchema = yup\n  .object({\n    x: yup.number().min(0).max(100).required(),\n    y: yup.number().min(0).max(100).required(),\n  })\n  .nullable()\n  .default(null);\n\nconst fileInfoSchema = yup.object({\n  name: yup.string().required(),\n  alternativeText: yup.string(),\n  caption: yup.string(),\n  focalPoint: focalPointSchema,\n  folder: yup.number(),\n});\n\nexport interface Asset extends Omit<FileDefinition, 'folder'> {\n  isLocal?: boolean;\n  rawFile?: RawFile;\n  folder?: FileDefinition['folder'] & { id: number };\n}\n\ninterface EditAssetContentProps {\n  asset?: Asset;\n  canUpdate?: boolean;\n  canCopyLink?: boolean;\n  canDownload?: boolean;\n  trackedLocation?: string;\n  onClose: (arg?: Asset | null | boolean) => void;\n  omitFields?: ('caption' | 'alternativeText')[];\n  omitActions?: 'replace'[];\n}\n\ninterface FormInitialData {\n  name?: string;\n  alternativeText?: string;\n  caption?: string;\n  focalPoint?: FocalPoint | null;\n  parent?: {\n    value?: number;\n    label: string;\n  };\n}\n\nexport const EditAssetContent = ({\n  onClose,\n  asset,\n  canUpdate = false,\n  canCopyLink = false,\n  canDownload = false,\n  trackedLocation,\n  omitFields = [],\n  omitActions = [],\n}: EditAssetContentProps) => {\n  const { formatMessage, formatDate } = useIntl();\n  const { trackUsage } = useTracking();\n  const submitButtonRef = React.useRef<HTMLButtonElement>(null);\n  const [isCropping, setIsCropping] = React.useState(false);\n  const [isFocalPointMode, setIsFocalPointMode] = React.useState(false);\n  const [replacementFile, setReplacementFile] = React.useState<File | undefined>();\n  const { editAsset, isLoading } = useEditAsset();\n\n  const { data: folderStructure, isLoading: folderStructureIsLoading } = useFolderStructure({\n    enabled: true,\n  });\n\n  const handleSubmit = async (values: FormInitialData) => {\n    const nextAsset = { ...asset, ...values, folder: values.parent?.value } as Asset;\n\n    if (asset?.isLocal) {\n      onClose(nextAsset);\n    } else {\n      const editedAsset = (await editAsset(nextAsset, replacementFile!)) as Asset;\n\n      const assetType = asset?.mime?.split('/')[0];\n      // if the folder parent was the root of Media Library, its id is null\n      // we know it changed location if the new parent value exists\n      const didChangeLocation = asset?.folder?.id\n        ? asset.folder.id !== values.parent?.value\n        : asset?.folder === null && !!values.parent?.value;\n\n      trackUsage('didEditMediaLibraryElements', {\n        location: trackedLocation,\n        type: assetType,\n        changeLocation: didChangeLocation,\n      });\n\n      onClose(editedAsset);\n    }\n  };\n\n  const handleStartCropping = () => {\n    setIsCropping(true);\n  };\n\n  const handleCancelCropping = () => {\n    setIsCropping(false);\n  };\n\n  const handleFinishCropping = () => {\n    setIsCropping(false);\n    onClose();\n  };\n\n  const handleFocalPointStart = () => {\n    setIsFocalPointMode(true);\n  };\n\n  const handleFocalPointCancel = () => {\n    setIsFocalPointMode(false);\n  };\n\n  const formDisabled = !canUpdate || isCropping || isFocalPointMode;\n\n  const handleConfirmClose = () => {\n    // eslint-disable-next-line no-alert\n    const confirm = window.confirm(\n      formatMessage({\n        id: 'window.confirm.close-modal.file',\n        defaultMessage: 'Are you sure? Your changes will be lost.',\n      })\n    );\n\n    if (confirm) {\n      onClose();\n    }\n  };\n\n  const activeFolderId = asset?.folder?.id;\n  const initialFormData = !folderStructureIsLoading && {\n    name: asset?.name,\n    alternativeText: asset?.alternativeText ?? undefined,\n    caption: asset?.caption ?? undefined,\n    focalPoint: asset?.focalPoint ?? null,\n    parent: {\n      value: activeFolderId ?? undefined,\n      label:\n        findRecursiveFolderByValue(folderStructure!, activeFolderId!)?.label ??\n        folderStructure![0].label,\n    },\n  };\n\n  const handleClose = (values?: { [key: string]: unknown }) => {\n    if (!isEqual(initialFormData, values)) {\n      handleConfirmClose();\n    } else {\n      onClose();\n    }\n  };\n\n  if (folderStructureIsLoading) {\n    return (\n      <>\n        <DialogHeader />\n        <LoadingBody minHeight=\"60vh\" justifyContent=\"center\" paddingTop={4} paddingBottom={4}>\n          <Loader>\n            {formatMessage({\n              id: getTrad('content.isLoading'),\n              defaultMessage: 'Content is loading.',\n            })}\n          </Loader>\n        </LoadingBody>\n        <Modal.Footer>\n          <Button onClick={() => handleClose()} variant=\"tertiary\">\n            {formatMessage({ id: 'cancel', defaultMessage: 'Cancel' })}\n          </Button>\n        </Modal.Footer>\n      </>\n    );\n  }\n\n  return (\n    <Formik\n      validationSchema={fileInfoSchema}\n      validateOnChange={false}\n      onSubmit={handleSubmit}\n      initialValues={initialFormData}\n    >\n      {({ values, errors, handleChange, setFieldValue }) => (\n        <>\n          <DialogHeader />\n          <Modal.Body>\n            <Grid.Root gap={4}>\n              <Grid.Item xs={12} col={6} direction=\"column\" alignItems=\"stretch\">\n                <PreviewBox\n                  asset={asset!}\n                  canUpdate={canUpdate}\n                  canCopyLink={canCopyLink}\n                  canDownload={canDownload}\n                  onDelete={onClose}\n                  onCropFinish={handleFinishCropping}\n                  onCropStart={handleStartCropping}\n                  onCropCancel={handleCancelCropping}\n                  replacementFile={replacementFile}\n                  trackedLocation={trackedLocation}\n                  formFocalPoint={values.focalPoint}\n                  onFocalPointStart={handleFocalPointStart}\n                  onFocalPointFinish={(focalPoint) => {\n                    setIsFocalPointMode(false);\n                    setFieldValue('focalPoint', focalPoint);\n                  }}\n                  onFocalPointCancel={handleFocalPointCancel}\n                />\n              </Grid.Item>\n              <Grid.Item xs={12} col={6} direction=\"column\" alignItems=\"stretch\">\n                <Form noValidate>\n                  <Flex direction=\"column\" alignItems=\"stretch\" gap={3}>\n                    <ContextInfo\n                      blocks={[\n                        {\n                          label: formatMessage({\n                            id: getTrad('modal.file-details.size'),\n                            defaultMessage: 'Size',\n                          }),\n                          value: formatBytes(asset?.size ? asset.size : 0),\n                        },\n\n                        {\n                          label: formatMessage({\n                            id: getTrad('modal.file-details.dimensions'),\n                            defaultMessage: 'Dimensions',\n                          }),\n                          value:\n                            asset?.height && asset.width ? `${asset.width}✕${asset.height}` : null,\n                        },\n\n                        {\n                          label: formatMessage({\n                            id: getTrad('modal.file-details.date'),\n                            defaultMessage: 'Date',\n                          }),\n                          value: formatDate(new Date(asset?.createdAt ? asset.createdAt : '')),\n                        },\n\n                        {\n                          label: formatMessage({\n                            id: getTrad('modal.file-details.extension'),\n                            defaultMessage: 'Extension',\n                          }),\n                          value: getFileExtension(asset?.ext)!,\n                        },\n\n                        {\n                          label: formatMessage({\n                            id: getTrad('modal.file-details.id'),\n                            defaultMessage: 'Asset ID',\n                          }),\n                          value: asset?.id ? asset.id : null,\n                        },\n\n                        ...(values.focalPoint\n                          ? [\n                              {\n                                label: formatMessage({\n                                  id: getTrad('modal.file-details.focal-point'),\n                                  defaultMessage: 'Focal point',\n                                }),\n                                value: `x: ${values.focalPoint.x}% - y: ${values.focalPoint.y}%`,\n                              },\n                            ]\n                          : []),\n                      ]}\n                    />\n                    <Field.Root name=\"name\" error={errors.name}>\n                      <Field.Label>\n                        {formatMessage({\n                          id: getTrad('form.input.label.file-name'),\n                          defaultMessage: 'File name',\n                        })}\n                      </Field.Label>\n                      <TextInput\n                        value={values.name}\n                        onChange={handleChange}\n                        disabled={formDisabled}\n                        type=\"text\"\n                      />\n                      <Field.Error />\n                    </Field.Root>\n\n                    {!omitFields?.includes('alternativeText') && (\n                      <Field.Root\n                        name=\"alternativeText\"\n                        hint={formatMessage({\n                          id: getTrad('form.input.description.file-alt'),\n                          defaultMessage:\n                            'This text will be displayed if the asset can’t be shown.',\n                        })}\n                        error={errors.alternativeText}\n                      >\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('form.input.label.file-alt'),\n                            defaultMessage: 'Alternative text',\n                          })}\n                        </Field.Label>\n                        <TextInput\n                          value={values.alternativeText}\n                          onChange={handleChange}\n                          disabled={formDisabled}\n                          type=\"text\"\n                        />\n                        <Field.Hint />\n                        <Field.Error />\n                      </Field.Root>\n                    )}\n\n                    {!omitFields?.includes('caption') && (\n                      <Field.Root name=\"caption\" error={errors.caption}>\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('form.input.label.file-caption'),\n                            defaultMessage: 'Caption',\n                          })}\n                        </Field.Label>\n                        <TextInput\n                          value={values.caption}\n                          onChange={handleChange}\n                          disabled={formDisabled}\n                          type=\"text\"\n                        />\n                      </Field.Root>\n                    )}\n\n                    <Flex direction=\"column\" alignItems=\"stretch\" gap={1}>\n                      <Field.Root name=\"parent\" id=\"asset-folder\">\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('form.input.label.file-location'),\n                            defaultMessage: 'Location',\n                          })}\n                        </Field.Label>\n\n                        <SelectTree\n                          name=\"parent\"\n                          defaultValue={values.parent}\n                          options={folderStructure!}\n                          onChange={(value) => {\n                            setFieldValue('parent', value);\n                          }}\n                          menuPortalTarget={document.querySelector('body')}\n                          inputId=\"asset-folder\"\n                          isDisabled={formDisabled}\n                          error={errors?.parent}\n                          ariaErrorMessage=\"folder-parent-error\"\n                        />\n                      </Field.Root>\n                    </Flex>\n                  </Flex>\n\n                  <VisuallyHidden>\n                    <button\n                      type=\"submit\"\n                      tabIndex={-1}\n                      ref={submitButtonRef}\n                      disabled={formDisabled}\n                    >\n                      {formatMessage({ id: 'submit', defaultMessage: 'Submit' })}\n                    </button>\n                  </VisuallyHidden>\n                </Form>\n              </Grid.Item>\n            </Grid.Root>\n          </Modal.Body>\n          <Modal.Footer>\n            <Button onClick={() => handleClose({ ...values })} variant=\"tertiary\">\n              {formatMessage({ id: 'global.cancel', defaultMessage: 'Cancel' })}\n            </Button>\n            <Flex gap={2}>\n              {!omitActions?.includes('replace') && (\n                <ReplaceMediaButton\n                  onSelectMedia={setReplacementFile}\n                  acceptedMime={asset?.mime ?? ''}\n                  disabled={formDisabled}\n                  trackedLocation={trackedLocation}\n                />\n              )}\n\n              <Button\n                onClick={() => submitButtonRef.current?.click()}\n                loading={isLoading}\n                disabled={formDisabled}\n              >\n                {formatMessage({ id: 'global.finish', defaultMessage: 'Finish' })}\n              </Button>\n            </Flex>\n          </Modal.Footer>\n        </>\n      )}\n    </Formik>\n  );\n};\n\ninterface EditAssetDialogProps {\n  asset: Asset;\n  canUpdate?: boolean;\n  canCopyLink?: boolean;\n  canDownload?: boolean;\n  trackedLocation?: string;\n  open: boolean;\n  onClose: (arg?: Asset | null | boolean) => void;\n}\n\nexport const EditAssetDialog = ({\n  open,\n  onClose,\n  canUpdate = false,\n  canCopyLink = false,\n  canDownload = false,\n  ...restProps\n}: EditAssetDialogProps) => {\n  return (\n    <Modal.Root open={open} onOpenChange={onClose}>\n      <Modal.Content>\n        <EditAssetContent\n          onClose={onClose}\n          canUpdate={canUpdate}\n          canCopyLink={canCopyLink}\n          canDownload={canDownload}\n          {...restProps}\n        />\n      </Modal.Content>\n    </Modal.Root>\n  );\n};\n"],"names":["LoadingBody","styled","Flex","focalPointSchema","yup","object","x","number","min","max","required","y","nullable","default","fileInfoSchema","name","string","alternativeText","caption","focalPoint","folder","EditAssetContent","onClose","asset","canUpdate","canCopyLink","canDownload","trackedLocation","omitFields","omitActions","formatMessage","formatDate","useIntl","trackUsage","useTracking","submitButtonRef","React","useRef","isCropping","setIsCropping","useState","isFocalPointMode","setIsFocalPointMode","replacementFile","setReplacementFile","editAsset","isLoading","useEditAsset","data","folderStructure","folderStructureIsLoading","useFolderStructure","enabled","handleSubmit","values","nextAsset","parent","value","isLocal","editedAsset","assetType","mime","split","didChangeLocation","id","location","type","changeLocation","handleStartCropping","handleCancelCropping","handleFinishCropping","handleFocalPointStart","handleFocalPointCancel","formDisabled","handleConfirmClose","confirm","window","defaultMessage","activeFolderId","initialFormData","undefined","label","findRecursiveFolderByValue","handleClose","isEqual","_jsxs","_Fragment","_jsx","DialogHeader","minHeight","justifyContent","paddingTop","paddingBottom","Loader","getTrad","Modal","Footer","Button","onClick","variant","Formik","validationSchema","validateOnChange","onSubmit","initialValues","errors","handleChange","setFieldValue","Body","Grid","Root","gap","Item","xs","col","direction","alignItems","PreviewBox","onDelete","onCropFinish","onCropStart","onCropCancel","formFocalPoint","onFocalPointStart","onFocalPointFinish","onFocalPointCancel","Form","noValidate","ContextInfo","blocks","formatBytes","size","height","width","Date","createdAt","getFileExtension","ext","Field","error","Label","TextInput","onChange","disabled","Error","includes","hint","Hint","SelectTree","defaultValue","options","menuPortalTarget","document","querySelector","inputId","isDisabled","ariaErrorMessage","VisuallyHidden","button","tabIndex","ref","ReplaceMediaButton","onSelectMedia","acceptedMime","current","click","loading","EditAssetDialog","open","restProps","onOpenChange","Content"],"mappings":"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"}